webpackHotUpdate("vendors",{

/***/ "./node_modules/cozy-sharing/dist/state.js":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"receiveSharings\", function() { return receiveSharings; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"addSharing\", function() { return addSharing; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"updateSharing\", function() { return updateSharing; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"revokeRecipient\", function() { return revokeRecipient; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"revokeSelf\", function() { return revokeSelf; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"addSharingLink\", function() { return addSharingLink; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"updateSharingLink\", function() { return updateSharingLink; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"revokeSharingLink\", function() { return revokeSharingLink; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"receivePaths\", function() { return receivePaths; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"matchingInstanceName\", function() { return matchingInstanceName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isOwner\", function() { return isOwner; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"canReshare\", function() { return canReshare; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getOwner\", function() { return getOwner; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getRecipients\", function() { return getRecipients; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharingLink\", function() { return getSharingLink; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharingForSelf\", function() { return getSharingForSelf; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharingType\", function() { return getSharingType; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getDocumentSharing\", function() { return getDocumentSharing; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharingById\", function() { return getSharingById; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getDocumentPermissions\", function() { return getDocumentPermissions; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"hasSharedParent\", function() { return hasSharedParent; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"hasSharedChild\", function() { return hasSharedChild; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharedParentPath\", function() { return getSharedParentPath; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharedDocIds\", function() { return getSharedDocIds; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharingDocIds\", function() { return getSharingDocIds; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getExternalSharingIds\", function() { return getExternalSharingIds; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getPermissionDocIds\", function() { return getPermissionDocIds; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getDocumentSharingType\", function() { return getDocumentSharingType; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isReadOnlySharing\", function() { return isReadOnlySharing; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharedDocIdsBySharings\", function() { return getSharedDocIdsBySharings; });\n/* harmony import */ var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"./node_modules/@babel/runtime/helpers/toConsumableArray.js\");\n/* harmony import */ var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"./node_modules/@babel/runtime/helpers/objectWithoutProperties.js\");\n/* harmony import */ var _babel_runtime_helpers_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(\"./node_modules/@babel/runtime/helpers/defineProperty.js\");\n/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var lodash_get__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(\"./node_modules/lodash/get.js\");\n/* harmony import */ var lodash_get__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(lodash_get__WEBPACK_IMPORTED_MODULE_3__);\n\n\n\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default()(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\n\nvar RECEIVE_SHARINGS = 'RECEIVE_SHARINGS';\nvar ADD_SHARING = 'ADD_SHARING';\nvar UPDATE_SHARING = 'UPDATE_SHARING';\nvar REVOKE_RECIPIENT = 'REVOKE_RECIPIENT';\nvar REVOKE_SELF = 'REVOKE_SELF';\nvar ADD_SHARING_LINK = 'ADD_SHARING_LINK';\nvar UPDATE_SHARING_LINK = 'UPDATE_SHARING_LINK';\nvar REVOKE_SHARING_LINK = 'REVOKE_SHARING_LINK';\nvar RECEIVE_PATHS = 'RECEIVE_PATHS'; // actions\n\nvar receiveSharings = function receiveSharings(_ref) {\n  var instanceUri = _ref.instanceUri,\n      _ref$sharings = _ref.sharings,\n      sharings = _ref$sharings === void 0 ? [] : _ref$sharings,\n      _ref$permissions = _ref.permissions,\n      permissions = _ref$permissions === void 0 ? [] : _ref$permissions,\n      _ref$apps = _ref.apps,\n      apps = _ref$apps === void 0 ? [] : _ref$apps;\n  return {\n    type: RECEIVE_SHARINGS,\n    data: {\n      sharings: sharings.filter(function (s) {\n        console.log(s);\n        console.log('areAllRecipientsRevoked', areAllRecipientsRevoked(s));\n        console.log('hasBeenSelfRevoked', hasBeenSelfRevoked(s, instanceUri));\n        return !areAllRecipientsRevoked(s) && !hasBeenSelfRevoked(s, instanceUri);\n      }),\n      permissions: permissions,\n      apps: apps\n    }\n  };\n};\nvar addSharing = function addSharing(data, path) {\n  return {\n    type: ADD_SHARING,\n    data: data,\n    path: path\n  };\n};\nvar updateSharing = function updateSharing(sharing) {\n  return {\n    type: UPDATE_SHARING,\n    sharing: sharing\n  };\n};\nvar revokeRecipient = function revokeRecipient(sharing, index, path) {\n  return {\n    type: REVOKE_RECIPIENT,\n\n    /* We set revoked status to the revoked member.\n    We can't just simply remove it, 'cauz we use the index\n    to remove members..\n    */\n    sharing: _objectSpread(_objectSpread({}, sharing), {}, {\n      attributes: _objectSpread(_objectSpread({}, sharing.attributes), {}, {\n        members: sharing.attributes.members.map(function (m, idx) {\n          if (idx === index) {\n            return _objectSpread(_objectSpread({}, m), {}, {\n              status: 'revoked'\n            });\n          }\n\n          return m;\n        })\n      })\n    }),\n    path: path\n  };\n};\nvar revokeSelf = function revokeSelf(sharing) {\n  return {\n    type: REVOKE_SELF,\n    sharing: sharing\n  };\n};\nvar addSharingLink = function addSharingLink(data) {\n  return {\n    type: ADD_SHARING_LINK,\n    data: data\n  };\n};\nvar updateSharingLink = function updateSharingLink(data) {\n  return {\n    type: UPDATE_SHARING_LINK,\n    data: data\n  };\n};\nvar revokeSharingLink = function revokeSharingLink(permissions) {\n  return {\n    type: REVOKE_SHARING_LINK,\n    permissions: permissions\n  };\n};\nvar receivePaths = function receivePaths(paths) {\n  return {\n    type: RECEIVE_PATHS,\n    paths: paths\n  };\n};\nvar matchingInstanceName = function matchingInstanceName() {\n  var instanceUri = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  return function (shareMember) {\n    return shareMember.instance && shareMember.instance.toString().toLowerCase() === instanceUri.toLowerCase();\n  };\n}; // reducers\n\nvar byIdInitialState = {\n  sharings: [],\n  permissions: []\n};\n\nvar isItemEmpty = function isItemEmpty(item) {\n  return item.sharings.length === 0 && item.permissions.length === 0;\n};\n\nvar updateByIdItem = function updateByIdItem(state, id, updater) {\n  var byIdState = state[id],\n      rest = _babel_runtime_helpers_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1___default()(state, [id].map(_toPropertyKey));\n\n  var update = updater(byIdState || byIdInitialState);\n  return isItemEmpty(update) ? rest : _objectSpread(_objectSpread({}, rest), {}, _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default()({}, id, update));\n};\n\nvar indexSharing = function indexSharing() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var sharing = arguments.length > 1 ? arguments[1] : undefined;\n  var sharedDocs = getSharedDocIds(sharing);\n  return sharedDocs.reduce(function (byId, id) {\n    var updatedByIdItem = updateByIdItem(byId, id, function (state) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        // todo index by id instead of having an array\n        sharings: Object.values(state.sharings).includes(sharing.id) ? _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(state.sharings) : [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(state.sharings), [sharing.id])\n      });\n    });\n    return updatedByIdItem;\n  }, state);\n};\n\nvar forgetSharing = function forgetSharing() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var sharing = arguments.length > 1 ? arguments[1] : undefined;\n  return getSharedDocIds(sharing).reduce(function (byId, id) {\n    return updateByIdItem(byId, id, function (state) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        sharings: state.sharings.filter(function (sid) {\n          return sid !== sharing.id;\n        })\n      });\n    });\n  }, state);\n};\n\nvar indexPermission = function indexPermission() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var perm = arguments.length > 1 ? arguments[1] : undefined;\n  return getSharedDocIds(perm).reduce(function (byId, id) {\n    return updateByIdItem(byId, id, function (state) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        permissions: [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(state.permissions), [perm.id])\n      });\n    });\n  }, state);\n};\n\nvar forgetPermission = function forgetPermission() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var permission = arguments.length > 1 ? arguments[1] : undefined;\n  return getSharedDocIds(permission).reduce(function (byId, id) {\n    return updateByIdItem(byId, id, function (state) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        permissions: state.permissions.filter(function (pid) {\n          return pid !== permission.id;\n        })\n      });\n    });\n  }, state);\n};\n\nvar byDocId = function byDocId() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case RECEIVE_SHARINGS:\n      // eslint-disable-next-line no-case-declarations\n      var intermediaryState = action.data.sharings.reduce(function (byId, sharing) {\n        return indexSharing(byId, sharing);\n      }, state);\n      return action.data.permissions.reduce(function (byId, perm) {\n        return indexPermission(byId, perm);\n      }, intermediaryState);\n\n    case ADD_SHARING:\n      return indexSharing(state, action.data);\n\n    case REVOKE_RECIPIENT:\n    case UPDATE_SHARING:\n      if (areAllRecipientsRevoked(action.sharing)) {\n        return forgetSharing(state, action.sharing);\n      }\n\n      return state;\n\n    case ADD_SHARING_LINK:\n      if (!Array.isArray(action.data)) {\n        return indexPermission(state, action.data);\n      } else {\n        var clonedState = _objectSpread({}, state);\n\n        action.data.map(function (s) {\n          clonedState = _objectSpread({}, indexPermission(clonedState, s));\n        });\n        return clonedState;\n      }\n\n    case REVOKE_SELF:\n      return forgetSharing(state, action.sharing);\n\n    case REVOKE_SHARING_LINK:\n      return action.permissions.reduce(function (byId, perm) {\n        return forgetPermission(byId, perm);\n      }, state);\n\n    default:\n      return state;\n  }\n};\n\nvar permissions = function permissions() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case RECEIVE_SHARINGS:\n      return action.data.permissions;\n\n    case ADD_SHARING_LINK:\n      if (!Array.isArray(action.data)) {\n        return [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(state), [action.data]);\n      } else {\n        return [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(state), _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(action.data));\n      }\n\n    case UPDATE_SHARING_LINK:\n      return state.map(function (p) {\n        return p.id === action.data.id ? action.data : p;\n      });\n\n    case REVOKE_SHARING_LINK:\n      // eslint-disable-next-line no-case-declarations\n      var permIds = action.permissions.map(function (p) {\n        return p.id;\n      });\n      return state.filter(function (p) {\n        return permIds.indexOf(p.id) === -1;\n      });\n\n    default:\n      return state;\n  }\n};\n\nvar apps = function apps() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case RECEIVE_SHARINGS:\n      return action.data.apps;\n\n    default:\n      return state;\n  }\n};\n\nvar sharings = function sharings() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case RECEIVE_SHARINGS:\n      return action.data.sharings;\n\n    case ADD_SHARING:\n      // be sure that we're not adding the sharing twice\n      // can be the case if we launch the create and\n      // receive the realtime in the same time\n      // TODO Index by index...\n      // eslint-disable-next-line\n      var filtered_state = state.filter(function (s) {\n        return s.id !== action.data.id;\n      });\n      return [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(filtered_state), [action.data]);\n\n    case UPDATE_SHARING:\n    case REVOKE_RECIPIENT:\n      return state.map(function (s) {\n        return s.id !== action.sharing.id ? s : action.sharing;\n      });\n\n    case REVOKE_SELF:\n      return state.filter(function (s) {\n        return s.id !== action.sharing.id;\n      });\n\n    default:\n      return state;\n  }\n};\n\nvar sharedPaths = function sharedPaths() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case RECEIVE_PATHS:\n      // !TODO Remove after we solved the sharedPaths bugs\n      // eslint-disable-next-line\n      return action.paths;\n\n    case ADD_SHARING:\n      // !TODO Remove after we solved the sharedPaths bugs\n      // eslint-disable-next-line\n      var newState = [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(state), [action.path]);\n      return newState;\n\n    case REVOKE_RECIPIENT:\n      if (areAllRecipientsRevoked(action.sharing)) {\n        return state.filter(function (p) {\n          return p !== action.path;\n        });\n      }\n\n      return state;\n\n    default:\n      return state;\n  }\n};\n\nvar reducer = function reducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var action = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return {\n    byDocId: byDocId(state.byDocId, action),\n    sharings: sharings(state.sharings, action),\n    permissions: permissions(state.permissions, action),\n    apps: apps(state.apps, action),\n    sharedPaths: sharedPaths(state.sharedPaths, action)\n  };\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (reducer); // selectors\n\nvar isOwner = function isOwner(state, docId) {\n  if (state.byDocId[docId] && state.byDocId[docId].sharings.length !== 0) {\n    return getSharingById(state, state.byDocId[docId].sharings[0]).attributes.owner === true;\n  }\n\n  return true;\n};\nvar canReshare = function canReshare(state, docId, instanceUri) {\n  var sharing = getDocumentSharing(state, docId);\n  var me = sharing.attributes.members.find(matchingInstanceName(instanceUri));\n  return sharing.attributes.open_sharing === true && me && !me.read_only;\n};\nvar getOwner = function getOwner(state, docId) {\n  return getRecipients(state, docId).find(function (r) {\n    return r.status === 'owner';\n  });\n};\nvar getRecipients = function getRecipients(state, docId) {\n  var recipients = getDocumentSharings(state, docId).map(function (sharing) {\n    var type = getDocumentSharingType(sharing, docId);\n    return sharing.attributes.members.map(function (m, idx) {\n      return _objectSpread(_objectSpread({}, m), {}, {\n        type: m.read_only ? 'one-way' : type,\n        sharingId: sharing.id,\n        index: idx,\n        avatarPath: \"/sharings/\".concat(sharing.id, \"/recipients/\").concat(idx, \"/avatar\")\n      });\n    });\n  }).reduce(function (acc, member) {\n    return acc.concat(member);\n  }, []).filter(function (r) {\n    return r.status !== 'revoked';\n  });\n\n  if (recipients[0] && recipients[0].status === 'owner') {\n    return [recipients[0]].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(recipients.filter(function (r) {\n      return r.status !== 'owner';\n    })));\n  }\n\n  return recipients;\n};\nvar getSharingLink = function getSharingLink(state, docId, documentType) {\n  // This shouldn't have happened, but unfortunately some duplicate sharing links have been created in the past\n  var perms = getDocumentPermissions(state, docId);\n  if (perms.length === 0) return null;\n  var perm = perms[0]; // We used to use `email` as `codes` attribute for a sharingByLink.\n  // But when we use cozy-client to create a Permission, by default\n  // the codes attribute is set to `code`. MesPapiers app is using this\n  // default behavior... So the sharing by link created by mes papiers\n  // didn't appear correctly in cozy-sharing.\n  // This is a bit ugly, we should have a better way to know if this is\n  // a sharing by link or not.\n\n  var code = lodash_get__WEBPACK_IMPORTED_MODULE_3___default()(perm, 'attributes.shortcodes.email') || lodash_get__WEBPACK_IMPORTED_MODULE_3___default()(perm, 'attributes.shortcodes.code') || lodash_get__WEBPACK_IMPORTED_MODULE_3___default()(perm, 'attributes.codes.email') || lodash_get__WEBPACK_IMPORTED_MODULE_3___default()(perm, 'attributes.codes.code');\n\n  if (code) {\n    return buildSharingLink(state, documentType, code);\n  } else {\n    return null;\n  }\n};\nvar getSharingForSelf = function getSharingForSelf(state, docId) {\n  return getDocumentSharing(state, docId);\n};\nvar getSharingType = function getSharingType(state, docId, instanceUri) {\n  var sharing = getSharingForSelf(state, docId);\n  if (!sharing) return false;\n  var type = getDocumentSharingType(sharing, docId);\n  if (sharing.attributes.owner) return type;\n  var me = sharing.attributes.members.find(matchingInstanceName(instanceUri));\n  return me && me.read_only ? 'one-way' : type;\n};\nvar getDocumentSharing = function getDocumentSharing(state, docId) {\n  return getDocumentSharings(state, docId)[0] || null;\n};\n\nvar getDocumentSharings = function getDocumentSharings(state, docId) {\n  return !state.byDocId[docId] ? [] : state.byDocId[docId].sharings.map(function (id) {\n    return getSharingById(state, id);\n  });\n};\n\nvar getSharingById = function getSharingById(state, id) {\n  return state.sharings.find(function (s) {\n    return s.id === id;\n  });\n};\nvar getDocumentPermissions = function getDocumentPermissions(state, docId) {\n  return !state.byDocId[docId] ? [] : state.byDocId[docId].permissions.map(function (id) {\n    return getPermissionById(state, id);\n  });\n};\n\nvar getPermissionById = function getPermissionById(state, id) {\n  return state.permissions.find(function (s) {\n    return s.id === id;\n  });\n};\n\nvar getApps = function getApps(state) {\n  return state.apps;\n};\n\nvar hasSharedParent = function hasSharedParent(state, documentPath) {\n  if (!state.sharedPaths) {\n    return false; // hasSharedParent should not occur\n  }\n\n  return state.sharedPaths.some(function (path) {\n    return documentPath.indexOf(\"\".concat(path, \"/\")) === 0;\n  });\n};\nvar hasSharedChild = function hasSharedChild(state, documentPath) {\n  if (!state.sharedPaths) {\n    return false; // hasSharedChild should not occur\n  }\n\n  var ret = state.sharedPaths.some(function (path) {\n    return path.indexOf(\"\".concat(documentPath, \"/\")) === 0;\n  });\n  return ret;\n};\n/**\n * Returns the path of the shared parent for a given document\n * @param {object} state - Redux state\n * @param {string} documentPath - Path of the given document\n * @returns {string|null} Path of the shared parent\n */\n\nvar getSharedParentPath = function getSharedParentPath(state, documentPath) {\n  if (hasSharedParent(state, documentPath)) {\n    return state.sharedPaths.find(function (path) {\n      return documentPath.startsWith(path);\n    });\n  }\n\n  return null;\n}; // helpers\n\nvar getSharedDocIds = function getSharedDocIds(doc) {\n  return doc.type === 'io.cozy.sharings' ? getSharingDocIds(doc) : getPermissionDocIds(doc);\n};\nvar getSharingDocIds = function getSharingDocIds(sharing) {\n  var docs = sharing.attributes.rules.map(function (r) {\n    return r.values;\n  }).reduce(function (acc, val) {\n    return acc.concat(val);\n  }, []);\n\n  if (sharing.attributes.shortcut_id) {\n    docs.push(sharing.attributes.shortcut_id);\n  }\n\n  return docs;\n};\n/**\n * Get ids of shared documents, but only if sharing is ready so files exist\n * @param {object} sharing\n * @param {string} instanceUri\n * @returns {string[]} List of document ids of a sharing\n */\n\nvar getExternalSharingIds = function getExternalSharingIds(sharing, instanceUri) {\n  var member = sharing.attributes.members.find(function (member) {\n    return member.instance === instanceUri;\n  });\n  var docs = [];\n\n  if ((member === null || member === void 0 ? void 0 : member.status) === 'ready') {\n    docs = sharing.attributes.rules.map(function (r) {\n      return r.values;\n    }).reduce(function (acc, val) {\n      return acc.concat(val);\n    }, []);\n  }\n\n  if (sharing.attributes.shortcut_id) {\n    docs.push(sharing.attributes.shortcut_id);\n  }\n\n  return docs;\n}; // Some permissions can not have values since they can\n// be on a global doctype. In that case, we can't sort\n// them by id\n\nvar getPermissionDocIds = function getPermissionDocIds(perm) {\n  return Object.keys(perm.attributes.permissions).map(function (k) {\n    return perm.attributes.permissions[k].values ? perm.attributes.permissions[k].values : [];\n  }).reduce(function (acc, val) {\n    return [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(acc), _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(val));\n  }, []);\n};\n\nvar areAllRecipientsRevoked = function areAllRecipientsRevoked(sharing) {\n  return sharing.attributes.owner && sharing.attributes.members.filter(function (m) {\n    return m.status !== 'revoked';\n  }).length === 1;\n};\n\nvar hasBeenSelfRevoked = function hasBeenSelfRevoked(sharing, instanceUri) {\n  var me = sharing.attributes.members.find(matchingInstanceName(instanceUri));\n  return !sharing.attributes.owner && me && me.status === 'revoked';\n};\n/**\n * Returns the sharing rule of a document\n * @param {object} sharing - The sharing\n * @param {string} docId - Id of the shared document\n * @returns {object} sharing rule\n */\n\n\nvar getSharingRule = function getSharingRule(sharing, docId) {\n  return sharing.attributes.rules.find(function (r) {\n    return r.values.indexOf(docId) !== -1;\n  });\n};\n/**\n * Returns the sharing type of a directory\n * @param {object} rule - Sharing rule of a document\n * @returns {string} two-way or one-way\n */\n\n\nvar getDirectorySharingType = function getDirectorySharingType(rule) {\n  // If a document has no rule, it is a shortcut preview of a sharing.\n  // Since the sharing hasn't been accepted, it can't be synced so we return the \"one-way\" type.\n  // TODO : the sharing type shouldn't be based on rule but on ready_only prop of the member\n  return rule && rule.update === 'sync' && rule.remove === 'sync' ? 'two-way' : 'one-way';\n};\n/**\n * Returns the sharing type of a file\n * @param {object} rule - Sharing rule of a document\n * @returns {string} two-way or one-way\n */\n\n\nvar getFileSharingType = function getFileSharingType(rule) {\n  // If a document has no rule, it is a shortcut preview of a sharing.\n  // Since the sharing hasn't been accepted, it can't be synced so we return the \"one-way\" type.\n  // TODO : the sharing type shouldn't be based on rule but on ready_only prop of the member\n  return rule && rule.update === 'sync' && rule.remove === 'revoke' ? 'two-way' : 'one-way';\n};\n/**\n * Returns the sharing type of a document\n * @param {object} sharing - The sharing\n * @param {string} docId - Id of the shared document\n * @returns {string} two-way or one-way\n */\n\n\nvar getDocumentSharingType = function getDocumentSharingType(sharing, docId) {\n  if (!sharing) return null;\n  var rule = getSharingRule(sharing, docId);\n  var directorySharingType = getDirectorySharingType(rule);\n  var fileSharingType = getFileSharingType(rule);\n  return directorySharingType === 'two-way' || fileSharingType === 'two-way' ? 'two-way' : 'one-way';\n};\nvar isReadOnlySharing = function isReadOnlySharing(sharing, docId) {\n  var rule = getSharingRule(sharing, docId);\n  var directorySharingType = getDirectorySharingType(rule);\n  var fileSharingType = getFileSharingType(rule);\n  return directorySharingType === 'two-way' || fileSharingType === 'two-way' ? false : true;\n};\n\nvar buildSharingLink = function buildSharingLink(state, documentType, sharecode) {\n  var appUrl = getAppUrlForDoctype(state, documentType);\n\n  switch (documentType) {\n    case 'Notes':\n      return \"\".concat(appUrl, \"public/?sharecode=\").concat(sharecode);\n\n    default:\n      return \"\".concat(appUrl, \"public?sharecode=\").concat(sharecode);\n  }\n};\n\nvar getAppUrlForDoctype = function getAppUrlForDoctype(state, documentType) {\n  var apps = getApps(state);\n\n  switch (documentType) {\n    case 'Notes':\n      return getAppUrl(apps, 'notes');\n\n    case 'Files':\n    case 'Document':\n      return getAppUrl(apps, 'drive');\n\n    case 'Albums':\n      return getAppUrl(apps, 'photos');\n\n    default:\n      throw new Error(\"Sharing link: don't know which app to use for doctype \".concat(documentType));\n  }\n};\n\nvar getAppUrl = function getAppUrl(apps, appName) {\n  var app = apps.find(function (a) {\n    return a.attributes.slug === appName && a.attributes.state === 'ready';\n  });\n\n  if (!app) {\n    throw new Error(\"Sharing link: app \".concat(appName, \" not installed\"));\n  }\n\n  return app.links.related;\n};\n/**\n *\n * @param {SharingCollection} sharings\n * @return {Array} Array of docIds\n */\n\n\nvar getSharedDocIdsBySharings = function getSharedDocIdsBySharings(sharings) {\n  var docs = [];\n  if (!sharings.data) return [];\n  sharings.data.forEach(function (s) {\n    if (s.attributes && s.attributes.active) {\n      docs.push.apply(docs, _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(getSharingDocIds(s)));\n    }\n  });\n  return docs;\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvY296eS1zaGFyaW5nL2Rpc3Qvc3RhdGUuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvY296eS1zaGFyaW5nL2Rpc3Qvc3RhdGUuanM/OTcwYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL3RvQ29uc3VtYWJsZUFycmF5XCI7XG5pbXBvcnQgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzIGZyb20gXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzXCI7XG5pbXBvcnQgX2RlZmluZVByb3BlcnR5IGZyb20gXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2RlZmluZVByb3BlcnR5XCI7XG5cbmZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykgeyB2YXIga2V5ID0gX3RvUHJpbWl0aXZlKGFyZywgXCJzdHJpbmdcIik7IHJldHVybiB0eXBlb2Yga2V5ID09PSBcInN5bWJvbFwiID8ga2V5IDogU3RyaW5nKGtleSk7IH1cblxuZnVuY3Rpb24gX3RvUHJpbWl0aXZlKGlucHV0LCBoaW50KSB7IGlmICh0eXBlb2YgaW5wdXQgIT09IFwib2JqZWN0XCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDsgdmFyIHByaW0gPSBpbnB1dFtTeW1ib2wudG9QcmltaXRpdmVdOyBpZiAocHJpbSAhPT0gdW5kZWZpbmVkKSB7IHZhciByZXMgPSBwcmltLmNhbGwoaW5wdXQsIGhpbnQgfHwgXCJkZWZhdWx0XCIpOyBpZiAodHlwZW9mIHJlcyAhPT0gXCJvYmplY3RcIikgcmV0dXJuIHJlczsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkBAdG9QcmltaXRpdmUgbXVzdCByZXR1cm4gYSBwcmltaXRpdmUgdmFsdWUuXCIpOyB9IHJldHVybiAoaGludCA9PT0gXCJzdHJpbmdcIiA/IFN0cmluZyA6IE51bWJlcikoaW5wdXQpOyB9XG5cbmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBlbnVtZXJhYmxlT25seSAmJiAoc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pKSwga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9XG5cbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBudWxsICE9IGFyZ3VtZW50c1tpXSA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpICUgMiA/IG93bktleXMoT2JqZWN0KHNvdXJjZSksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpIDogb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSByZXR1cm4gdGFyZ2V0OyB9XG5cbmltcG9ydCBnZXQgZnJvbSAnbG9kYXNoL2dldCc7XG52YXIgUkVDRUlWRV9TSEFSSU5HUyA9ICdSRUNFSVZFX1NIQVJJTkdTJztcbnZhciBBRERfU0hBUklORyA9ICdBRERfU0hBUklORyc7XG52YXIgVVBEQVRFX1NIQVJJTkcgPSAnVVBEQVRFX1NIQVJJTkcnO1xudmFyIFJFVk9LRV9SRUNJUElFTlQgPSAnUkVWT0tFX1JFQ0lQSUVOVCc7XG52YXIgUkVWT0tFX1NFTEYgPSAnUkVWT0tFX1NFTEYnO1xudmFyIEFERF9TSEFSSU5HX0xJTksgPSAnQUREX1NIQVJJTkdfTElOSyc7XG52YXIgVVBEQVRFX1NIQVJJTkdfTElOSyA9ICdVUERBVEVfU0hBUklOR19MSU5LJztcbnZhciBSRVZPS0VfU0hBUklOR19MSU5LID0gJ1JFVk9LRV9TSEFSSU5HX0xJTksnO1xudmFyIFJFQ0VJVkVfUEFUSFMgPSAnUkVDRUlWRV9QQVRIUyc7IC8vIGFjdGlvbnNcblxuZXhwb3J0IHZhciByZWNlaXZlU2hhcmluZ3MgPSBmdW5jdGlvbiByZWNlaXZlU2hhcmluZ3MoX3JlZikge1xuICB2YXIgaW5zdGFuY2VVcmkgPSBfcmVmLmluc3RhbmNlVXJpLFxuICAgICAgX3JlZiRzaGFyaW5ncyA9IF9yZWYuc2hhcmluZ3MsXG4gICAgICBzaGFyaW5ncyA9IF9yZWYkc2hhcmluZ3MgPT09IHZvaWQgMCA/IFtdIDogX3JlZiRzaGFyaW5ncyxcbiAgICAgIF9yZWYkcGVybWlzc2lvbnMgPSBfcmVmLnBlcm1pc3Npb25zLFxuICAgICAgcGVybWlzc2lvbnMgPSBfcmVmJHBlcm1pc3Npb25zID09PSB2b2lkIDAgPyBbXSA6IF9yZWYkcGVybWlzc2lvbnMsXG4gICAgICBfcmVmJGFwcHMgPSBfcmVmLmFwcHMsXG4gICAgICBhcHBzID0gX3JlZiRhcHBzID09PSB2b2lkIDAgPyBbXSA6IF9yZWYkYXBwcztcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBSRUNFSVZFX1NIQVJJTkdTLFxuICAgIGRhdGE6IHtcbiAgICAgIHNoYXJpbmdzOiBzaGFyaW5ncy5maWx0ZXIoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgY29uc29sZS5sb2cocyk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdhcmVBbGxSZWNpcGllbnRzUmV2b2tlZCcsIGFyZUFsbFJlY2lwaWVudHNSZXZva2VkKHMpKTtcbiAgICAgICAgY29uc29sZS5sb2coJ2hhc0JlZW5TZWxmUmV2b2tlZCcsIGhhc0JlZW5TZWxmUmV2b2tlZChzLCBpbnN0YW5jZVVyaSkpO1xuICAgICAgICByZXR1cm4gIWFyZUFsbFJlY2lwaWVudHNSZXZva2VkKHMpICYmICFoYXNCZWVuU2VsZlJldm9rZWQocywgaW5zdGFuY2VVcmkpO1xuICAgICAgfSksXG4gICAgICBwZXJtaXNzaW9uczogcGVybWlzc2lvbnMsXG4gICAgICBhcHBzOiBhcHBzXG4gICAgfVxuICB9O1xufTtcbmV4cG9ydCB2YXIgYWRkU2hhcmluZyA9IGZ1bmN0aW9uIGFkZFNoYXJpbmcoZGF0YSwgcGF0aCkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IEFERF9TSEFSSU5HLFxuICAgIGRhdGE6IGRhdGEsXG4gICAgcGF0aDogcGF0aFxuICB9O1xufTtcbmV4cG9ydCB2YXIgdXBkYXRlU2hhcmluZyA9IGZ1bmN0aW9uIHVwZGF0ZVNoYXJpbmcoc2hhcmluZykge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFVQREFURV9TSEFSSU5HLFxuICAgIHNoYXJpbmc6IHNoYXJpbmdcbiAgfTtcbn07XG5leHBvcnQgdmFyIHJldm9rZVJlY2lwaWVudCA9IGZ1bmN0aW9uIHJldm9rZVJlY2lwaWVudChzaGFyaW5nLCBpbmRleCwgcGF0aCkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFJFVk9LRV9SRUNJUElFTlQsXG5cbiAgICAvKiBXZSBzZXQgcmV2b2tlZCBzdGF0dXMgdG8gdGhlIHJldm9rZWQgbWVtYmVyLlxuICAgIFdlIGNhbid0IGp1c3Qgc2ltcGx5IHJlbW92ZSBpdCwgJ2NhdXogd2UgdXNlIHRoZSBpbmRleFxuICAgIHRvIHJlbW92ZSBtZW1iZXJzLi5cbiAgICAqL1xuICAgIHNoYXJpbmc6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc2hhcmluZyksIHt9LCB7XG4gICAgICBhdHRyaWJ1dGVzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHNoYXJpbmcuYXR0cmlidXRlcyksIHt9LCB7XG4gICAgICAgIG1lbWJlcnM6IHNoYXJpbmcuYXR0cmlidXRlcy5tZW1iZXJzLm1hcChmdW5jdGlvbiAobSwgaWR4KSB7XG4gICAgICAgICAgaWYgKGlkeCA9PT0gaW5kZXgpIHtcbiAgICAgICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG0pLCB7fSwge1xuICAgICAgICAgICAgICBzdGF0dXM6ICdyZXZva2VkJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIG07XG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH0pLFxuICAgIHBhdGg6IHBhdGhcbiAgfTtcbn07XG5leHBvcnQgdmFyIHJldm9rZVNlbGYgPSBmdW5jdGlvbiByZXZva2VTZWxmKHNoYXJpbmcpIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBSRVZPS0VfU0VMRixcbiAgICBzaGFyaW5nOiBzaGFyaW5nXG4gIH07XG59O1xuZXhwb3J0IHZhciBhZGRTaGFyaW5nTGluayA9IGZ1bmN0aW9uIGFkZFNoYXJpbmdMaW5rKGRhdGEpIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBBRERfU0hBUklOR19MSU5LLFxuICAgIGRhdGE6IGRhdGFcbiAgfTtcbn07XG5leHBvcnQgdmFyIHVwZGF0ZVNoYXJpbmdMaW5rID0gZnVuY3Rpb24gdXBkYXRlU2hhcmluZ0xpbmsoZGF0YSkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFVQREFURV9TSEFSSU5HX0xJTkssXG4gICAgZGF0YTogZGF0YVxuICB9O1xufTtcbmV4cG9ydCB2YXIgcmV2b2tlU2hhcmluZ0xpbmsgPSBmdW5jdGlvbiByZXZva2VTaGFyaW5nTGluayhwZXJtaXNzaW9ucykge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFJFVk9LRV9TSEFSSU5HX0xJTkssXG4gICAgcGVybWlzc2lvbnM6IHBlcm1pc3Npb25zXG4gIH07XG59O1xuZXhwb3J0IHZhciByZWNlaXZlUGF0aHMgPSBmdW5jdGlvbiByZWNlaXZlUGF0aHMocGF0aHMpIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBSRUNFSVZFX1BBVEhTLFxuICAgIHBhdGhzOiBwYXRoc1xuICB9O1xufTtcbmV4cG9ydCB2YXIgbWF0Y2hpbmdJbnN0YW5jZU5hbWUgPSBmdW5jdGlvbiBtYXRjaGluZ0luc3RhbmNlTmFtZSgpIHtcbiAgdmFyIGluc3RhbmNlVXJpID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAnJztcbiAgcmV0dXJuIGZ1bmN0aW9uIChzaGFyZU1lbWJlcikge1xuICAgIHJldHVybiBzaGFyZU1lbWJlci5pbnN0YW5jZSAmJiBzaGFyZU1lbWJlci5pbnN0YW5jZS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkgPT09IGluc3RhbmNlVXJpLnRvTG93ZXJDYXNlKCk7XG4gIH07XG59OyAvLyByZWR1Y2Vyc1xuXG52YXIgYnlJZEluaXRpYWxTdGF0ZSA9IHtcbiAgc2hhcmluZ3M6IFtdLFxuICBwZXJtaXNzaW9uczogW11cbn07XG5cbnZhciBpc0l0ZW1FbXB0eSA9IGZ1bmN0aW9uIGlzSXRlbUVtcHR5KGl0ZW0pIHtcbiAgcmV0dXJuIGl0ZW0uc2hhcmluZ3MubGVuZ3RoID09PSAwICYmIGl0ZW0ucGVybWlzc2lvbnMubGVuZ3RoID09PSAwO1xufTtcblxudmFyIHVwZGF0ZUJ5SWRJdGVtID0gZnVuY3Rpb24gdXBkYXRlQnlJZEl0ZW0oc3RhdGUsIGlkLCB1cGRhdGVyKSB7XG4gIHZhciBieUlkU3RhdGUgPSBzdGF0ZVtpZF0sXG4gICAgICByZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHN0YXRlLCBbaWRdLm1hcChfdG9Qcm9wZXJ0eUtleSkpO1xuXG4gIHZhciB1cGRhdGUgPSB1cGRhdGVyKGJ5SWRTdGF0ZSB8fCBieUlkSW5pdGlhbFN0YXRlKTtcbiAgcmV0dXJuIGlzSXRlbUVtcHR5KHVwZGF0ZSkgPyByZXN0IDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCByZXN0KSwge30sIF9kZWZpbmVQcm9wZXJ0eSh7fSwgaWQsIHVwZGF0ZSkpO1xufTtcblxudmFyIGluZGV4U2hhcmluZyA9IGZ1bmN0aW9uIGluZGV4U2hhcmluZygpIHtcbiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTtcbiAgdmFyIHNoYXJpbmcgPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDtcbiAgdmFyIHNoYXJlZERvY3MgPSBnZXRTaGFyZWREb2NJZHMoc2hhcmluZyk7XG4gIHJldHVybiBzaGFyZWREb2NzLnJlZHVjZShmdW5jdGlvbiAoYnlJZCwgaWQpIHtcbiAgICB2YXIgdXBkYXRlZEJ5SWRJdGVtID0gdXBkYXRlQnlJZEl0ZW0oYnlJZCwgaWQsIGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc3RhdGUpLCB7fSwge1xuICAgICAgICAvLyB0b2RvIGluZGV4IGJ5IGlkIGluc3RlYWQgb2YgaGF2aW5nIGFuIGFycmF5XG4gICAgICAgIHNoYXJpbmdzOiBPYmplY3QudmFsdWVzKHN0YXRlLnNoYXJpbmdzKS5pbmNsdWRlcyhzaGFyaW5nLmlkKSA/IF90b0NvbnN1bWFibGVBcnJheShzdGF0ZS5zaGFyaW5ncykgOiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlLnNoYXJpbmdzKSwgW3NoYXJpbmcuaWRdKVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHVwZGF0ZWRCeUlkSXRlbTtcbiAgfSwgc3RhdGUpO1xufTtcblxudmFyIGZvcmdldFNoYXJpbmcgPSBmdW5jdGlvbiBmb3JnZXRTaGFyaW5nKCkge1xuICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9O1xuICB2YXIgc2hhcmluZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkO1xuICByZXR1cm4gZ2V0U2hhcmVkRG9jSWRzKHNoYXJpbmcpLnJlZHVjZShmdW5jdGlvbiAoYnlJZCwgaWQpIHtcbiAgICByZXR1cm4gdXBkYXRlQnlJZEl0ZW0oYnlJZCwgaWQsIGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc3RhdGUpLCB7fSwge1xuICAgICAgICBzaGFyaW5nczogc3RhdGUuc2hhcmluZ3MuZmlsdGVyKGZ1bmN0aW9uIChzaWQpIHtcbiAgICAgICAgICByZXR1cm4gc2lkICE9PSBzaGFyaW5nLmlkO1xuICAgICAgICB9KVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sIHN0YXRlKTtcbn07XG5cbnZhciBpbmRleFBlcm1pc3Npb24gPSBmdW5jdGlvbiBpbmRleFBlcm1pc3Npb24oKSB7XG4gIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307XG4gIHZhciBwZXJtID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7XG4gIHJldHVybiBnZXRTaGFyZWREb2NJZHMocGVybSkucmVkdWNlKGZ1bmN0aW9uIChieUlkLCBpZCkge1xuICAgIHJldHVybiB1cGRhdGVCeUlkSXRlbShieUlkLCBpZCwgZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSksIHt9LCB7XG4gICAgICAgIHBlcm1pc3Npb25zOiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlLnBlcm1pc3Npb25zKSwgW3Blcm0uaWRdKVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sIHN0YXRlKTtcbn07XG5cbnZhciBmb3JnZXRQZXJtaXNzaW9uID0gZnVuY3Rpb24gZm9yZ2V0UGVybWlzc2lvbigpIHtcbiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTtcbiAgdmFyIHBlcm1pc3Npb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDtcbiAgcmV0dXJuIGdldFNoYXJlZERvY0lkcyhwZXJtaXNzaW9uKS5yZWR1Y2UoZnVuY3Rpb24gKGJ5SWQsIGlkKSB7XG4gICAgcmV0dXJuIHVwZGF0ZUJ5SWRJdGVtKGJ5SWQsIGlkLCBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHN0YXRlKSwge30sIHtcbiAgICAgICAgcGVybWlzc2lvbnM6IHN0YXRlLnBlcm1pc3Npb25zLmZpbHRlcihmdW5jdGlvbiAocGlkKSB7XG4gICAgICAgICAgcmV0dXJuIHBpZCAhPT0gcGVybWlzc2lvbi5pZDtcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9LCBzdGF0ZSk7XG59O1xuXG52YXIgYnlEb2NJZCA9IGZ1bmN0aW9uIGJ5RG9jSWQoKSB7XG4gIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307XG4gIHZhciBhY3Rpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDtcblxuICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XG4gICAgY2FzZSBSRUNFSVZFX1NIQVJJTkdTOlxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNhc2UtZGVjbGFyYXRpb25zXG4gICAgICB2YXIgaW50ZXJtZWRpYXJ5U3RhdGUgPSBhY3Rpb24uZGF0YS5zaGFyaW5ncy5yZWR1Y2UoZnVuY3Rpb24gKGJ5SWQsIHNoYXJpbmcpIHtcbiAgICAgICAgcmV0dXJuIGluZGV4U2hhcmluZyhieUlkLCBzaGFyaW5nKTtcbiAgICAgIH0sIHN0YXRlKTtcbiAgICAgIHJldHVybiBhY3Rpb24uZGF0YS5wZXJtaXNzaW9ucy5yZWR1Y2UoZnVuY3Rpb24gKGJ5SWQsIHBlcm0pIHtcbiAgICAgICAgcmV0dXJuIGluZGV4UGVybWlzc2lvbihieUlkLCBwZXJtKTtcbiAgICAgIH0sIGludGVybWVkaWFyeVN0YXRlKTtcblxuICAgIGNhc2UgQUREX1NIQVJJTkc6XG4gICAgICByZXR1cm4gaW5kZXhTaGFyaW5nKHN0YXRlLCBhY3Rpb24uZGF0YSk7XG5cbiAgICBjYXNlIFJFVk9LRV9SRUNJUElFTlQ6XG4gICAgY2FzZSBVUERBVEVfU0hBUklORzpcbiAgICAgIGlmIChhcmVBbGxSZWNpcGllbnRzUmV2b2tlZChhY3Rpb24uc2hhcmluZykpIHtcbiAgICAgICAgcmV0dXJuIGZvcmdldFNoYXJpbmcoc3RhdGUsIGFjdGlvbi5zaGFyaW5nKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHN0YXRlO1xuXG4gICAgY2FzZSBBRERfU0hBUklOR19MSU5LOlxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGFjdGlvbi5kYXRhKSkge1xuICAgICAgICByZXR1cm4gaW5kZXhQZXJtaXNzaW9uKHN0YXRlLCBhY3Rpb24uZGF0YSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgY2xvbmVkU3RhdGUgPSBfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSk7XG5cbiAgICAgICAgYWN0aW9uLmRhdGEubWFwKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgICAgY2xvbmVkU3RhdGUgPSBfb2JqZWN0U3ByZWFkKHt9LCBpbmRleFBlcm1pc3Npb24oY2xvbmVkU3RhdGUsIHMpKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBjbG9uZWRTdGF0ZTtcbiAgICAgIH1cblxuICAgIGNhc2UgUkVWT0tFX1NFTEY6XG4gICAgICByZXR1cm4gZm9yZ2V0U2hhcmluZyhzdGF0ZSwgYWN0aW9uLnNoYXJpbmcpO1xuXG4gICAgY2FzZSBSRVZPS0VfU0hBUklOR19MSU5LOlxuICAgICAgcmV0dXJuIGFjdGlvbi5wZXJtaXNzaW9ucy5yZWR1Y2UoZnVuY3Rpb24gKGJ5SWQsIHBlcm0pIHtcbiAgICAgICAgcmV0dXJuIGZvcmdldFBlcm1pc3Npb24oYnlJZCwgcGVybSk7XG4gICAgICB9LCBzdGF0ZSk7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHN0YXRlO1xuICB9XG59O1xuXG52YXIgcGVybWlzc2lvbnMgPSBmdW5jdGlvbiBwZXJtaXNzaW9ucygpIHtcbiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTtcbiAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkO1xuXG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICBjYXNlIFJFQ0VJVkVfU0hBUklOR1M6XG4gICAgICByZXR1cm4gYWN0aW9uLmRhdGEucGVybWlzc2lvbnM7XG5cbiAgICBjYXNlIEFERF9TSEFSSU5HX0xJTks6XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkoYWN0aW9uLmRhdGEpKSB7XG4gICAgICAgIHJldHVybiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlKSwgW2FjdGlvbi5kYXRhXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShzdGF0ZSksIF90b0NvbnN1bWFibGVBcnJheShhY3Rpb24uZGF0YSkpO1xuICAgICAgfVxuXG4gICAgY2FzZSBVUERBVEVfU0hBUklOR19MSU5LOlxuICAgICAgcmV0dXJuIHN0YXRlLm1hcChmdW5jdGlvbiAocCkge1xuICAgICAgICByZXR1cm4gcC5pZCA9PT0gYWN0aW9uLmRhdGEuaWQgPyBhY3Rpb24uZGF0YSA6IHA7XG4gICAgICB9KTtcblxuICAgIGNhc2UgUkVWT0tFX1NIQVJJTkdfTElOSzpcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jYXNlLWRlY2xhcmF0aW9uc1xuICAgICAgdmFyIHBlcm1JZHMgPSBhY3Rpb24ucGVybWlzc2lvbnMubWFwKGZ1bmN0aW9uIChwKSB7XG4gICAgICAgIHJldHVybiBwLmlkO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gc3RhdGUuZmlsdGVyKGZ1bmN0aW9uIChwKSB7XG4gICAgICAgIHJldHVybiBwZXJtSWRzLmluZGV4T2YocC5pZCkgPT09IC0xO1xuICAgICAgfSk7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHN0YXRlO1xuICB9XG59O1xuXG52YXIgYXBwcyA9IGZ1bmN0aW9uIGFwcHMoKSB7XG4gIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107XG4gIHZhciBhY3Rpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDtcblxuICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XG4gICAgY2FzZSBSRUNFSVZFX1NIQVJJTkdTOlxuICAgICAgcmV0dXJuIGFjdGlvbi5kYXRhLmFwcHM7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHN0YXRlO1xuICB9XG59O1xuXG52YXIgc2hhcmluZ3MgPSBmdW5jdGlvbiBzaGFyaW5ncygpIHtcbiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTtcbiAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkO1xuXG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICBjYXNlIFJFQ0VJVkVfU0hBUklOR1M6XG4gICAgICByZXR1cm4gYWN0aW9uLmRhdGEuc2hhcmluZ3M7XG5cbiAgICBjYXNlIEFERF9TSEFSSU5HOlxuICAgICAgLy8gYmUgc3VyZSB0aGF0IHdlJ3JlIG5vdCBhZGRpbmcgdGhlIHNoYXJpbmcgdHdpY2VcbiAgICAgIC8vIGNhbiBiZSB0aGUgY2FzZSBpZiB3ZSBsYXVuY2ggdGhlIGNyZWF0ZSBhbmRcbiAgICAgIC8vIHJlY2VpdmUgdGhlIHJlYWx0aW1lIGluIHRoZSBzYW1lIHRpbWVcbiAgICAgIC8vIFRPRE8gSW5kZXggYnkgaW5kZXguLi5cbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgICAgdmFyIGZpbHRlcmVkX3N0YXRlID0gc3RhdGUuZmlsdGVyKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBzLmlkICE9PSBhY3Rpb24uZGF0YS5pZDtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoZmlsdGVyZWRfc3RhdGUpLCBbYWN0aW9uLmRhdGFdKTtcblxuICAgIGNhc2UgVVBEQVRFX1NIQVJJTkc6XG4gICAgY2FzZSBSRVZPS0VfUkVDSVBJRU5UOlxuICAgICAgcmV0dXJuIHN0YXRlLm1hcChmdW5jdGlvbiAocykge1xuICAgICAgICByZXR1cm4gcy5pZCAhPT0gYWN0aW9uLnNoYXJpbmcuaWQgPyBzIDogYWN0aW9uLnNoYXJpbmc7XG4gICAgICB9KTtcblxuICAgIGNhc2UgUkVWT0tFX1NFTEY6XG4gICAgICByZXR1cm4gc3RhdGUuZmlsdGVyKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBzLmlkICE9PSBhY3Rpb24uc2hhcmluZy5pZDtcbiAgICAgIH0pO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBzdGF0ZTtcbiAgfVxufTtcblxudmFyIHNoYXJlZFBhdGhzID0gZnVuY3Rpb24gc2hhcmVkUGF0aHMoKSB7XG4gIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107XG4gIHZhciBhY3Rpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDtcblxuICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XG4gICAgY2FzZSBSRUNFSVZFX1BBVEhTOlxuICAgICAgLy8gIVRPRE8gUmVtb3ZlIGFmdGVyIHdlIHNvbHZlZCB0aGUgc2hhcmVkUGF0aHMgYnVnc1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICByZXR1cm4gYWN0aW9uLnBhdGhzO1xuXG4gICAgY2FzZSBBRERfU0hBUklORzpcbiAgICAgIC8vICFUT0RPIFJlbW92ZSBhZnRlciB3ZSBzb2x2ZWQgdGhlIHNoYXJlZFBhdGhzIGJ1Z3NcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZVxuICAgICAgdmFyIG5ld1N0YXRlID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShzdGF0ZSksIFthY3Rpb24ucGF0aF0pO1xuICAgICAgcmV0dXJuIG5ld1N0YXRlO1xuXG4gICAgY2FzZSBSRVZPS0VfUkVDSVBJRU5UOlxuICAgICAgaWYgKGFyZUFsbFJlY2lwaWVudHNSZXZva2VkKGFjdGlvbi5zaGFyaW5nKSkge1xuICAgICAgICByZXR1cm4gc3RhdGUuZmlsdGVyKGZ1bmN0aW9uIChwKSB7XG4gICAgICAgICAgcmV0dXJuIHAgIT09IGFjdGlvbi5wYXRoO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHN0YXRlO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBzdGF0ZTtcbiAgfVxufTtcblxudmFyIHJlZHVjZXIgPSBmdW5jdGlvbiByZWR1Y2VyKCkge1xuICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9O1xuICB2YXIgYWN0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTtcbiAgcmV0dXJuIHtcbiAgICBieURvY0lkOiBieURvY0lkKHN0YXRlLmJ5RG9jSWQsIGFjdGlvbiksXG4gICAgc2hhcmluZ3M6IHNoYXJpbmdzKHN0YXRlLnNoYXJpbmdzLCBhY3Rpb24pLFxuICAgIHBlcm1pc3Npb25zOiBwZXJtaXNzaW9ucyhzdGF0ZS5wZXJtaXNzaW9ucywgYWN0aW9uKSxcbiAgICBhcHBzOiBhcHBzKHN0YXRlLmFwcHMsIGFjdGlvbiksXG4gICAgc2hhcmVkUGF0aHM6IHNoYXJlZFBhdGhzKHN0YXRlLnNoYXJlZFBhdGhzLCBhY3Rpb24pXG4gIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCByZWR1Y2VyOyAvLyBzZWxlY3RvcnNcblxuZXhwb3J0IHZhciBpc093bmVyID0gZnVuY3Rpb24gaXNPd25lcihzdGF0ZSwgZG9jSWQpIHtcbiAgaWYgKHN0YXRlLmJ5RG9jSWRbZG9jSWRdICYmIHN0YXRlLmJ5RG9jSWRbZG9jSWRdLnNoYXJpbmdzLmxlbmd0aCAhPT0gMCkge1xuICAgIHJldHVybiBnZXRTaGFyaW5nQnlJZChzdGF0ZSwgc3RhdGUuYnlEb2NJZFtkb2NJZF0uc2hhcmluZ3NbMF0pLmF0dHJpYnV0ZXMub3duZXIgPT09IHRydWU7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5leHBvcnQgdmFyIGNhblJlc2hhcmUgPSBmdW5jdGlvbiBjYW5SZXNoYXJlKHN0YXRlLCBkb2NJZCwgaW5zdGFuY2VVcmkpIHtcbiAgdmFyIHNoYXJpbmcgPSBnZXREb2N1bWVudFNoYXJpbmcoc3RhdGUsIGRvY0lkKTtcbiAgdmFyIG1lID0gc2hhcmluZy5hdHRyaWJ1dGVzLm1lbWJlcnMuZmluZChtYXRjaGluZ0luc3RhbmNlTmFtZShpbnN0YW5jZVVyaSkpO1xuICByZXR1cm4gc2hhcmluZy5hdHRyaWJ1dGVzLm9wZW5fc2hhcmluZyA9PT0gdHJ1ZSAmJiBtZSAmJiAhbWUucmVhZF9vbmx5O1xufTtcbmV4cG9ydCB2YXIgZ2V0T3duZXIgPSBmdW5jdGlvbiBnZXRPd25lcihzdGF0ZSwgZG9jSWQpIHtcbiAgcmV0dXJuIGdldFJlY2lwaWVudHMoc3RhdGUsIGRvY0lkKS5maW5kKGZ1bmN0aW9uIChyKSB7XG4gICAgcmV0dXJuIHIuc3RhdHVzID09PSAnb3duZXInO1xuICB9KTtcbn07XG5leHBvcnQgdmFyIGdldFJlY2lwaWVudHMgPSBmdW5jdGlvbiBnZXRSZWNpcGllbnRzKHN0YXRlLCBkb2NJZCkge1xuICB2YXIgcmVjaXBpZW50cyA9IGdldERvY3VtZW50U2hhcmluZ3Moc3RhdGUsIGRvY0lkKS5tYXAoZnVuY3Rpb24gKHNoYXJpbmcpIHtcbiAgICB2YXIgdHlwZSA9IGdldERvY3VtZW50U2hhcmluZ1R5cGUoc2hhcmluZywgZG9jSWQpO1xuICAgIHJldHVybiBzaGFyaW5nLmF0dHJpYnV0ZXMubWVtYmVycy5tYXAoZnVuY3Rpb24gKG0sIGlkeCkge1xuICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgbSksIHt9LCB7XG4gICAgICAgIHR5cGU6IG0ucmVhZF9vbmx5ID8gJ29uZS13YXknIDogdHlwZSxcbiAgICAgICAgc2hhcmluZ0lkOiBzaGFyaW5nLmlkLFxuICAgICAgICBpbmRleDogaWR4LFxuICAgICAgICBhdmF0YXJQYXRoOiBcIi9zaGFyaW5ncy9cIi5jb25jYXQoc2hhcmluZy5pZCwgXCIvcmVjaXBpZW50cy9cIikuY29uY2F0KGlkeCwgXCIvYXZhdGFyXCIpXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIG1lbWJlcikge1xuICAgIHJldHVybiBhY2MuY29uY2F0KG1lbWJlcik7XG4gIH0sIFtdKS5maWx0ZXIoZnVuY3Rpb24gKHIpIHtcbiAgICByZXR1cm4gci5zdGF0dXMgIT09ICdyZXZva2VkJztcbiAgfSk7XG5cbiAgaWYgKHJlY2lwaWVudHNbMF0gJiYgcmVjaXBpZW50c1swXS5zdGF0dXMgPT09ICdvd25lcicpIHtcbiAgICByZXR1cm4gW3JlY2lwaWVudHNbMF1dLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkocmVjaXBpZW50cy5maWx0ZXIoZnVuY3Rpb24gKHIpIHtcbiAgICAgIHJldHVybiByLnN0YXR1cyAhPT0gJ293bmVyJztcbiAgICB9KSkpO1xuICB9XG5cbiAgcmV0dXJuIHJlY2lwaWVudHM7XG59O1xuZXhwb3J0IHZhciBnZXRTaGFyaW5nTGluayA9IGZ1bmN0aW9uIGdldFNoYXJpbmdMaW5rKHN0YXRlLCBkb2NJZCwgZG9jdW1lbnRUeXBlKSB7XG4gIC8vIFRoaXMgc2hvdWxkbid0IGhhdmUgaGFwcGVuZWQsIGJ1dCB1bmZvcnR1bmF0ZWx5IHNvbWUgZHVwbGljYXRlIHNoYXJpbmcgbGlua3MgaGF2ZSBiZWVuIGNyZWF0ZWQgaW4gdGhlIHBhc3RcbiAgdmFyIHBlcm1zID0gZ2V0RG9jdW1lbnRQZXJtaXNzaW9ucyhzdGF0ZSwgZG9jSWQpO1xuICBpZiAocGVybXMubGVuZ3RoID09PSAwKSByZXR1cm4gbnVsbDtcbiAgdmFyIHBlcm0gPSBwZXJtc1swXTsgLy8gV2UgdXNlZCB0byB1c2UgYGVtYWlsYCBhcyBgY29kZXNgIGF0dHJpYnV0ZSBmb3IgYSBzaGFyaW5nQnlMaW5rLlxuICAvLyBCdXQgd2hlbiB3ZSB1c2UgY296eS1jbGllbnQgdG8gY3JlYXRlIGEgUGVybWlzc2lvbiwgYnkgZGVmYXVsdFxuICAvLyB0aGUgY29kZXMgYXR0cmlidXRlIGlzIHNldCB0byBgY29kZWAuIE1lc1BhcGllcnMgYXBwIGlzIHVzaW5nIHRoaXNcbiAgLy8gZGVmYXVsdCBiZWhhdmlvci4uLiBTbyB0aGUgc2hhcmluZyBieSBsaW5rIGNyZWF0ZWQgYnkgbWVzIHBhcGllcnNcbiAgLy8gZGlkbid0IGFwcGVhciBjb3JyZWN0bHkgaW4gY296eS1zaGFyaW5nLlxuICAvLyBUaGlzIGlzIGEgYml0IHVnbHksIHdlIHNob3VsZCBoYXZlIGEgYmV0dGVyIHdheSB0byBrbm93IGlmIHRoaXMgaXNcbiAgLy8gYSBzaGFyaW5nIGJ5IGxpbmsgb3Igbm90LlxuXG4gIHZhciBjb2RlID0gZ2V0KHBlcm0sICdhdHRyaWJ1dGVzLnNob3J0Y29kZXMuZW1haWwnKSB8fCBnZXQocGVybSwgJ2F0dHJpYnV0ZXMuc2hvcnRjb2Rlcy5jb2RlJykgfHwgZ2V0KHBlcm0sICdhdHRyaWJ1dGVzLmNvZGVzLmVtYWlsJykgfHwgZ2V0KHBlcm0sICdhdHRyaWJ1dGVzLmNvZGVzLmNvZGUnKTtcblxuICBpZiAoY29kZSkge1xuICAgIHJldHVybiBidWlsZFNoYXJpbmdMaW5rKHN0YXRlLCBkb2N1bWVudFR5cGUsIGNvZGUpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuZXhwb3J0IHZhciBnZXRTaGFyaW5nRm9yU2VsZiA9IGZ1bmN0aW9uIGdldFNoYXJpbmdGb3JTZWxmKHN0YXRlLCBkb2NJZCkge1xuICByZXR1cm4gZ2V0RG9jdW1lbnRTaGFyaW5nKHN0YXRlLCBkb2NJZCk7XG59O1xuZXhwb3J0IHZhciBnZXRTaGFyaW5nVHlwZSA9IGZ1bmN0aW9uIGdldFNoYXJpbmdUeXBlKHN0YXRlLCBkb2NJZCwgaW5zdGFuY2VVcmkpIHtcbiAgdmFyIHNoYXJpbmcgPSBnZXRTaGFyaW5nRm9yU2VsZihzdGF0ZSwgZG9jSWQpO1xuICBpZiAoIXNoYXJpbmcpIHJldHVybiBmYWxzZTtcbiAgdmFyIHR5cGUgPSBnZXREb2N1bWVudFNoYXJpbmdUeXBlKHNoYXJpbmcsIGRvY0lkKTtcbiAgaWYgKHNoYXJpbmcuYXR0cmlidXRlcy5vd25lcikgcmV0dXJuIHR5cGU7XG4gIHZhciBtZSA9IHNoYXJpbmcuYXR0cmlidXRlcy5tZW1iZXJzLmZpbmQobWF0Y2hpbmdJbnN0YW5jZU5hbWUoaW5zdGFuY2VVcmkpKTtcbiAgcmV0dXJuIG1lICYmIG1lLnJlYWRfb25seSA/ICdvbmUtd2F5JyA6IHR5cGU7XG59O1xuZXhwb3J0IHZhciBnZXREb2N1bWVudFNoYXJpbmcgPSBmdW5jdGlvbiBnZXREb2N1bWVudFNoYXJpbmcoc3RhdGUsIGRvY0lkKSB7XG4gIHJldHVybiBnZXREb2N1bWVudFNoYXJpbmdzKHN0YXRlLCBkb2NJZClbMF0gfHwgbnVsbDtcbn07XG5cbnZhciBnZXREb2N1bWVudFNoYXJpbmdzID0gZnVuY3Rpb24gZ2V0RG9jdW1lbnRTaGFyaW5ncyhzdGF0ZSwgZG9jSWQpIHtcbiAgcmV0dXJuICFzdGF0ZS5ieURvY0lkW2RvY0lkXSA/IFtdIDogc3RhdGUuYnlEb2NJZFtkb2NJZF0uc2hhcmluZ3MubWFwKGZ1bmN0aW9uIChpZCkge1xuICAgIHJldHVybiBnZXRTaGFyaW5nQnlJZChzdGF0ZSwgaWQpO1xuICB9KTtcbn07XG5cbmV4cG9ydCB2YXIgZ2V0U2hhcmluZ0J5SWQgPSBmdW5jdGlvbiBnZXRTaGFyaW5nQnlJZChzdGF0ZSwgaWQpIHtcbiAgcmV0dXJuIHN0YXRlLnNoYXJpbmdzLmZpbmQoZnVuY3Rpb24gKHMpIHtcbiAgICByZXR1cm4gcy5pZCA9PT0gaWQ7XG4gIH0pO1xufTtcbmV4cG9ydCB2YXIgZ2V0RG9jdW1lbnRQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uIGdldERvY3VtZW50UGVybWlzc2lvbnMoc3RhdGUsIGRvY0lkKSB7XG4gIHJldHVybiAhc3RhdGUuYnlEb2NJZFtkb2NJZF0gPyBbXSA6IHN0YXRlLmJ5RG9jSWRbZG9jSWRdLnBlcm1pc3Npb25zLm1hcChmdW5jdGlvbiAoaWQpIHtcbiAgICByZXR1cm4gZ2V0UGVybWlzc2lvbkJ5SWQoc3RhdGUsIGlkKTtcbiAgfSk7XG59O1xuXG52YXIgZ2V0UGVybWlzc2lvbkJ5SWQgPSBmdW5jdGlvbiBnZXRQZXJtaXNzaW9uQnlJZChzdGF0ZSwgaWQpIHtcbiAgcmV0dXJuIHN0YXRlLnBlcm1pc3Npb25zLmZpbmQoZnVuY3Rpb24gKHMpIHtcbiAgICByZXR1cm4gcy5pZCA9PT0gaWQ7XG4gIH0pO1xufTtcblxudmFyIGdldEFwcHMgPSBmdW5jdGlvbiBnZXRBcHBzKHN0YXRlKSB7XG4gIHJldHVybiBzdGF0ZS5hcHBzO1xufTtcblxuZXhwb3J0IHZhciBoYXNTaGFyZWRQYXJlbnQgPSBmdW5jdGlvbiBoYXNTaGFyZWRQYXJlbnQoc3RhdGUsIGRvY3VtZW50UGF0aCkge1xuICBpZiAoIXN0YXRlLnNoYXJlZFBhdGhzKSB7XG4gICAgcmV0dXJuIGZhbHNlOyAvLyBoYXNTaGFyZWRQYXJlbnQgc2hvdWxkIG5vdCBvY2N1clxuICB9XG5cbiAgcmV0dXJuIHN0YXRlLnNoYXJlZFBhdGhzLnNvbWUoZnVuY3Rpb24gKHBhdGgpIHtcbiAgICByZXR1cm4gZG9jdW1lbnRQYXRoLmluZGV4T2YoXCJcIi5jb25jYXQocGF0aCwgXCIvXCIpKSA9PT0gMDtcbiAgfSk7XG59O1xuZXhwb3J0IHZhciBoYXNTaGFyZWRDaGlsZCA9IGZ1bmN0aW9uIGhhc1NoYXJlZENoaWxkKHN0YXRlLCBkb2N1bWVudFBhdGgpIHtcbiAgaWYgKCFzdGF0ZS5zaGFyZWRQYXRocykge1xuICAgIHJldHVybiBmYWxzZTsgLy8gaGFzU2hhcmVkQ2hpbGQgc2hvdWxkIG5vdCBvY2N1clxuICB9XG5cbiAgdmFyIHJldCA9IHN0YXRlLnNoYXJlZFBhdGhzLnNvbWUoZnVuY3Rpb24gKHBhdGgpIHtcbiAgICByZXR1cm4gcGF0aC5pbmRleE9mKFwiXCIuY29uY2F0KGRvY3VtZW50UGF0aCwgXCIvXCIpKSA9PT0gMDtcbiAgfSk7XG4gIHJldHVybiByZXQ7XG59O1xuLyoqXG4gKiBSZXR1cm5zIHRoZSBwYXRoIG9mIHRoZSBzaGFyZWQgcGFyZW50IGZvciBhIGdpdmVuIGRvY3VtZW50XG4gKiBAcGFyYW0ge29iamVjdH0gc3RhdGUgLSBSZWR1eCBzdGF0ZVxuICogQHBhcmFtIHtzdHJpbmd9IGRvY3VtZW50UGF0aCAtIFBhdGggb2YgdGhlIGdpdmVuIGRvY3VtZW50XG4gKiBAcmV0dXJucyB7c3RyaW5nfG51bGx9IFBhdGggb2YgdGhlIHNoYXJlZCBwYXJlbnRcbiAqL1xuXG5leHBvcnQgdmFyIGdldFNoYXJlZFBhcmVudFBhdGggPSBmdW5jdGlvbiBnZXRTaGFyZWRQYXJlbnRQYXRoKHN0YXRlLCBkb2N1bWVudFBhdGgpIHtcbiAgaWYgKGhhc1NoYXJlZFBhcmVudChzdGF0ZSwgZG9jdW1lbnRQYXRoKSkge1xuICAgIHJldHVybiBzdGF0ZS5zaGFyZWRQYXRocy5maW5kKGZ1bmN0aW9uIChwYXRoKSB7XG4gICAgICByZXR1cm4gZG9jdW1lbnRQYXRoLnN0YXJ0c1dpdGgocGF0aCk7XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn07IC8vIGhlbHBlcnNcblxuZXhwb3J0IHZhciBnZXRTaGFyZWREb2NJZHMgPSBmdW5jdGlvbiBnZXRTaGFyZWREb2NJZHMoZG9jKSB7XG4gIHJldHVybiBkb2MudHlwZSA9PT0gJ2lvLmNvenkuc2hhcmluZ3MnID8gZ2V0U2hhcmluZ0RvY0lkcyhkb2MpIDogZ2V0UGVybWlzc2lvbkRvY0lkcyhkb2MpO1xufTtcbmV4cG9ydCB2YXIgZ2V0U2hhcmluZ0RvY0lkcyA9IGZ1bmN0aW9uIGdldFNoYXJpbmdEb2NJZHMoc2hhcmluZykge1xuICB2YXIgZG9jcyA9IHNoYXJpbmcuYXR0cmlidXRlcy5ydWxlcy5tYXAoZnVuY3Rpb24gKHIpIHtcbiAgICByZXR1cm4gci52YWx1ZXM7XG4gIH0pLnJlZHVjZShmdW5jdGlvbiAoYWNjLCB2YWwpIHtcbiAgICByZXR1cm4gYWNjLmNvbmNhdCh2YWwpO1xuICB9LCBbXSk7XG5cbiAgaWYgKHNoYXJpbmcuYXR0cmlidXRlcy5zaG9ydGN1dF9pZCkge1xuICAgIGRvY3MucHVzaChzaGFyaW5nLmF0dHJpYnV0ZXMuc2hvcnRjdXRfaWQpO1xuICB9XG5cbiAgcmV0dXJuIGRvY3M7XG59O1xuLyoqXG4gKiBHZXQgaWRzIG9mIHNoYXJlZCBkb2N1bWVudHMsIGJ1dCBvbmx5IGlmIHNoYXJpbmcgaXMgcmVhZHkgc28gZmlsZXMgZXhpc3RcbiAqIEBwYXJhbSB7b2JqZWN0fSBzaGFyaW5nXG4gKiBAcGFyYW0ge3N0cmluZ30gaW5zdGFuY2VVcmlcbiAqIEByZXR1cm5zIHtzdHJpbmdbXX0gTGlzdCBvZiBkb2N1bWVudCBpZHMgb2YgYSBzaGFyaW5nXG4gKi9cblxuZXhwb3J0IHZhciBnZXRFeHRlcm5hbFNoYXJpbmdJZHMgPSBmdW5jdGlvbiBnZXRFeHRlcm5hbFNoYXJpbmdJZHMoc2hhcmluZywgaW5zdGFuY2VVcmkpIHtcbiAgdmFyIG1lbWJlciA9IHNoYXJpbmcuYXR0cmlidXRlcy5tZW1iZXJzLmZpbmQoZnVuY3Rpb24gKG1lbWJlcikge1xuICAgIHJldHVybiBtZW1iZXIuaW5zdGFuY2UgPT09IGluc3RhbmNlVXJpO1xuICB9KTtcbiAgdmFyIGRvY3MgPSBbXTtcblxuICBpZiAoKG1lbWJlciA9PT0gbnVsbCB8fCBtZW1iZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG1lbWJlci5zdGF0dXMpID09PSAncmVhZHknKSB7XG4gICAgZG9jcyA9IHNoYXJpbmcuYXR0cmlidXRlcy5ydWxlcy5tYXAoZnVuY3Rpb24gKHIpIHtcbiAgICAgIHJldHVybiByLnZhbHVlcztcbiAgICB9KS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgdmFsKSB7XG4gICAgICByZXR1cm4gYWNjLmNvbmNhdCh2YWwpO1xuICAgIH0sIFtdKTtcbiAgfVxuXG4gIGlmIChzaGFyaW5nLmF0dHJpYnV0ZXMuc2hvcnRjdXRfaWQpIHtcbiAgICBkb2NzLnB1c2goc2hhcmluZy5hdHRyaWJ1dGVzLnNob3J0Y3V0X2lkKTtcbiAgfVxuXG4gIHJldHVybiBkb2NzO1xufTsgLy8gU29tZSBwZXJtaXNzaW9ucyBjYW4gbm90IGhhdmUgdmFsdWVzIHNpbmNlIHRoZXkgY2FuXG4vLyBiZSBvbiBhIGdsb2JhbCBkb2N0eXBlLiBJbiB0aGF0IGNhc2UsIHdlIGNhbid0IHNvcnRcbi8vIHRoZW0gYnkgaWRcblxuZXhwb3J0IHZhciBnZXRQZXJtaXNzaW9uRG9jSWRzID0gZnVuY3Rpb24gZ2V0UGVybWlzc2lvbkRvY0lkcyhwZXJtKSB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhwZXJtLmF0dHJpYnV0ZXMucGVybWlzc2lvbnMpLm1hcChmdW5jdGlvbiAoaykge1xuICAgIHJldHVybiBwZXJtLmF0dHJpYnV0ZXMucGVybWlzc2lvbnNba10udmFsdWVzID8gcGVybS5hdHRyaWJ1dGVzLnBlcm1pc3Npb25zW2tdLnZhbHVlcyA6IFtdO1xuICB9KS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgdmFsKSB7XG4gICAgcmV0dXJuIFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoYWNjKSwgX3RvQ29uc3VtYWJsZUFycmF5KHZhbCkpO1xuICB9LCBbXSk7XG59O1xuXG52YXIgYXJlQWxsUmVjaXBpZW50c1Jldm9rZWQgPSBmdW5jdGlvbiBhcmVBbGxSZWNpcGllbnRzUmV2b2tlZChzaGFyaW5nKSB7XG4gIHJldHVybiBzaGFyaW5nLmF0dHJpYnV0ZXMub3duZXIgJiYgc2hhcmluZy5hdHRyaWJ1dGVzLm1lbWJlcnMuZmlsdGVyKGZ1bmN0aW9uIChtKSB7XG4gICAgcmV0dXJuIG0uc3RhdHVzICE9PSAncmV2b2tlZCc7XG4gIH0pLmxlbmd0aCA9PT0gMTtcbn07XG5cbnZhciBoYXNCZWVuU2VsZlJldm9rZWQgPSBmdW5jdGlvbiBoYXNCZWVuU2VsZlJldm9rZWQoc2hhcmluZywgaW5zdGFuY2VVcmkpIHtcbiAgdmFyIG1lID0gc2hhcmluZy5hdHRyaWJ1dGVzLm1lbWJlcnMuZmluZChtYXRjaGluZ0luc3RhbmNlTmFtZShpbnN0YW5jZVVyaSkpO1xuICByZXR1cm4gIXNoYXJpbmcuYXR0cmlidXRlcy5vd25lciAmJiBtZSAmJiBtZS5zdGF0dXMgPT09ICdyZXZva2VkJztcbn07XG4vKipcbiAqIFJldHVybnMgdGhlIHNoYXJpbmcgcnVsZSBvZiBhIGRvY3VtZW50XG4gKiBAcGFyYW0ge29iamVjdH0gc2hhcmluZyAtIFRoZSBzaGFyaW5nXG4gKiBAcGFyYW0ge3N0cmluZ30gZG9jSWQgLSBJZCBvZiB0aGUgc2hhcmVkIGRvY3VtZW50XG4gKiBAcmV0dXJucyB7b2JqZWN0fSBzaGFyaW5nIHJ1bGVcbiAqL1xuXG5cbnZhciBnZXRTaGFyaW5nUnVsZSA9IGZ1bmN0aW9uIGdldFNoYXJpbmdSdWxlKHNoYXJpbmcsIGRvY0lkKSB7XG4gIHJldHVybiBzaGFyaW5nLmF0dHJpYnV0ZXMucnVsZXMuZmluZChmdW5jdGlvbiAocikge1xuICAgIHJldHVybiByLnZhbHVlcy5pbmRleE9mKGRvY0lkKSAhPT0gLTE7XG4gIH0pO1xufTtcbi8qKlxuICogUmV0dXJucyB0aGUgc2hhcmluZyB0eXBlIG9mIGEgZGlyZWN0b3J5XG4gKiBAcGFyYW0ge29iamVjdH0gcnVsZSAtIFNoYXJpbmcgcnVsZSBvZiBhIGRvY3VtZW50XG4gKiBAcmV0dXJucyB7c3RyaW5nfSB0d28td2F5IG9yIG9uZS13YXlcbiAqL1xuXG5cbnZhciBnZXREaXJlY3RvcnlTaGFyaW5nVHlwZSA9IGZ1bmN0aW9uIGdldERpcmVjdG9yeVNoYXJpbmdUeXBlKHJ1bGUpIHtcbiAgLy8gSWYgYSBkb2N1bWVudCBoYXMgbm8gcnVsZSwgaXQgaXMgYSBzaG9ydGN1dCBwcmV2aWV3IG9mIGEgc2hhcmluZy5cbiAgLy8gU2luY2UgdGhlIHNoYXJpbmcgaGFzbid0IGJlZW4gYWNjZXB0ZWQsIGl0IGNhbid0IGJlIHN5bmNlZCBzbyB3ZSByZXR1cm4gdGhlIFwib25lLXdheVwiIHR5cGUuXG4gIC8vIFRPRE8gOiB0aGUgc2hhcmluZyB0eXBlIHNob3VsZG4ndCBiZSBiYXNlZCBvbiBydWxlIGJ1dCBvbiByZWFkeV9vbmx5IHByb3Agb2YgdGhlIG1lbWJlclxuICByZXR1cm4gcnVsZSAmJiBydWxlLnVwZGF0ZSA9PT0gJ3N5bmMnICYmIHJ1bGUucmVtb3ZlID09PSAnc3luYycgPyAndHdvLXdheScgOiAnb25lLXdheSc7XG59O1xuLyoqXG4gKiBSZXR1cm5zIHRoZSBzaGFyaW5nIHR5cGUgb2YgYSBmaWxlXG4gKiBAcGFyYW0ge29iamVjdH0gcnVsZSAtIFNoYXJpbmcgcnVsZSBvZiBhIGRvY3VtZW50XG4gKiBAcmV0dXJucyB7c3RyaW5nfSB0d28td2F5IG9yIG9uZS13YXlcbiAqL1xuXG5cbnZhciBnZXRGaWxlU2hhcmluZ1R5cGUgPSBmdW5jdGlvbiBnZXRGaWxlU2hhcmluZ1R5cGUocnVsZSkge1xuICAvLyBJZiBhIGRvY3VtZW50IGhhcyBubyBydWxlLCBpdCBpcyBhIHNob3J0Y3V0IHByZXZpZXcgb2YgYSBzaGFyaW5nLlxuICAvLyBTaW5jZSB0aGUgc2hhcmluZyBoYXNuJ3QgYmVlbiBhY2NlcHRlZCwgaXQgY2FuJ3QgYmUgc3luY2VkIHNvIHdlIHJldHVybiB0aGUgXCJvbmUtd2F5XCIgdHlwZS5cbiAgLy8gVE9ETyA6IHRoZSBzaGFyaW5nIHR5cGUgc2hvdWxkbid0IGJlIGJhc2VkIG9uIHJ1bGUgYnV0IG9uIHJlYWR5X29ubHkgcHJvcCBvZiB0aGUgbWVtYmVyXG4gIHJldHVybiBydWxlICYmIHJ1bGUudXBkYXRlID09PSAnc3luYycgJiYgcnVsZS5yZW1vdmUgPT09ICdyZXZva2UnID8gJ3R3by13YXknIDogJ29uZS13YXknO1xufTtcbi8qKlxuICogUmV0dXJucyB0aGUgc2hhcmluZyB0eXBlIG9mIGEgZG9jdW1lbnRcbiAqIEBwYXJhbSB7b2JqZWN0fSBzaGFyaW5nIC0gVGhlIHNoYXJpbmdcbiAqIEBwYXJhbSB7c3RyaW5nfSBkb2NJZCAtIElkIG9mIHRoZSBzaGFyZWQgZG9jdW1lbnRcbiAqIEByZXR1cm5zIHtzdHJpbmd9IHR3by13YXkgb3Igb25lLXdheVxuICovXG5cblxuZXhwb3J0IHZhciBnZXREb2N1bWVudFNoYXJpbmdUeXBlID0gZnVuY3Rpb24gZ2V0RG9jdW1lbnRTaGFyaW5nVHlwZShzaGFyaW5nLCBkb2NJZCkge1xuICBpZiAoIXNoYXJpbmcpIHJldHVybiBudWxsO1xuICB2YXIgcnVsZSA9IGdldFNoYXJpbmdSdWxlKHNoYXJpbmcsIGRvY0lkKTtcbiAgdmFyIGRpcmVjdG9yeVNoYXJpbmdUeXBlID0gZ2V0RGlyZWN0b3J5U2hhcmluZ1R5cGUocnVsZSk7XG4gIHZhciBmaWxlU2hhcmluZ1R5cGUgPSBnZXRGaWxlU2hhcmluZ1R5cGUocnVsZSk7XG4gIHJldHVybiBkaXJlY3RvcnlTaGFyaW5nVHlwZSA9PT0gJ3R3by13YXknIHx8IGZpbGVTaGFyaW5nVHlwZSA9PT0gJ3R3by13YXknID8gJ3R3by13YXknIDogJ29uZS13YXknO1xufTtcbmV4cG9ydCB2YXIgaXNSZWFkT25seVNoYXJpbmcgPSBmdW5jdGlvbiBpc1JlYWRPbmx5U2hhcmluZyhzaGFyaW5nLCBkb2NJZCkge1xuICB2YXIgcnVsZSA9IGdldFNoYXJpbmdSdWxlKHNoYXJpbmcsIGRvY0lkKTtcbiAgdmFyIGRpcmVjdG9yeVNoYXJpbmdUeXBlID0gZ2V0RGlyZWN0b3J5U2hhcmluZ1R5cGUocnVsZSk7XG4gIHZhciBmaWxlU2hhcmluZ1R5cGUgPSBnZXRGaWxlU2hhcmluZ1R5cGUocnVsZSk7XG4gIHJldHVybiBkaXJlY3RvcnlTaGFyaW5nVHlwZSA9PT0gJ3R3by13YXknIHx8IGZpbGVTaGFyaW5nVHlwZSA9PT0gJ3R3by13YXknID8gZmFsc2UgOiB0cnVlO1xufTtcblxudmFyIGJ1aWxkU2hhcmluZ0xpbmsgPSBmdW5jdGlvbiBidWlsZFNoYXJpbmdMaW5rKHN0YXRlLCBkb2N1bWVudFR5cGUsIHNoYXJlY29kZSkge1xuICB2YXIgYXBwVXJsID0gZ2V0QXBwVXJsRm9yRG9jdHlwZShzdGF0ZSwgZG9jdW1lbnRUeXBlKTtcblxuICBzd2l0Y2ggKGRvY3VtZW50VHlwZSkge1xuICAgIGNhc2UgJ05vdGVzJzpcbiAgICAgIHJldHVybiBcIlwiLmNvbmNhdChhcHBVcmwsIFwicHVibGljLz9zaGFyZWNvZGU9XCIpLmNvbmNhdChzaGFyZWNvZGUpO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBcIlwiLmNvbmNhdChhcHBVcmwsIFwicHVibGljP3NoYXJlY29kZT1cIikuY29uY2F0KHNoYXJlY29kZSk7XG4gIH1cbn07XG5cbnZhciBnZXRBcHBVcmxGb3JEb2N0eXBlID0gZnVuY3Rpb24gZ2V0QXBwVXJsRm9yRG9jdHlwZShzdGF0ZSwgZG9jdW1lbnRUeXBlKSB7XG4gIHZhciBhcHBzID0gZ2V0QXBwcyhzdGF0ZSk7XG5cbiAgc3dpdGNoIChkb2N1bWVudFR5cGUpIHtcbiAgICBjYXNlICdOb3Rlcyc6XG4gICAgICByZXR1cm4gZ2V0QXBwVXJsKGFwcHMsICdub3RlcycpO1xuXG4gICAgY2FzZSAnRmlsZXMnOlxuICAgIGNhc2UgJ0RvY3VtZW50JzpcbiAgICAgIHJldHVybiBnZXRBcHBVcmwoYXBwcywgJ2RyaXZlJyk7XG5cbiAgICBjYXNlICdBbGJ1bXMnOlxuICAgICAgcmV0dXJuIGdldEFwcFVybChhcHBzLCAncGhvdG9zJyk7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2hhcmluZyBsaW5rOiBkb24ndCBrbm93IHdoaWNoIGFwcCB0byB1c2UgZm9yIGRvY3R5cGUgXCIuY29uY2F0KGRvY3VtZW50VHlwZSkpO1xuICB9XG59O1xuXG52YXIgZ2V0QXBwVXJsID0gZnVuY3Rpb24gZ2V0QXBwVXJsKGFwcHMsIGFwcE5hbWUpIHtcbiAgdmFyIGFwcCA9IGFwcHMuZmluZChmdW5jdGlvbiAoYSkge1xuICAgIHJldHVybiBhLmF0dHJpYnV0ZXMuc2x1ZyA9PT0gYXBwTmFtZSAmJiBhLmF0dHJpYnV0ZXMuc3RhdGUgPT09ICdyZWFkeSc7XG4gIH0pO1xuXG4gIGlmICghYXBwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiU2hhcmluZyBsaW5rOiBhcHAgXCIuY29uY2F0KGFwcE5hbWUsIFwiIG5vdCBpbnN0YWxsZWRcIikpO1xuICB9XG5cbiAgcmV0dXJuIGFwcC5saW5rcy5yZWxhdGVkO1xufTtcbi8qKlxuICpcbiAqIEBwYXJhbSB7U2hhcmluZ0NvbGxlY3Rpb259IHNoYXJpbmdzXG4gKiBAcmV0dXJuIHtBcnJheX0gQXJyYXkgb2YgZG9jSWRzXG4gKi9cblxuXG5leHBvcnQgdmFyIGdldFNoYXJlZERvY0lkc0J5U2hhcmluZ3MgPSBmdW5jdGlvbiBnZXRTaGFyZWREb2NJZHNCeVNoYXJpbmdzKHNoYXJpbmdzKSB7XG4gIHZhciBkb2NzID0gW107XG4gIGlmICghc2hhcmluZ3MuZGF0YSkgcmV0dXJuIFtdO1xuICBzaGFyaW5ncy5kYXRhLmZvckVhY2goZnVuY3Rpb24gKHMpIHtcbiAgICBpZiAocy5hdHRyaWJ1dGVzICYmIHMuYXR0cmlidXRlcy5hY3RpdmUpIHtcbiAgICAgIGRvY3MucHVzaC5hcHBseShkb2NzLCBfdG9Db25zdW1hYmxlQXJyYXkoZ2V0U2hhcmluZ0RvY0lkcyhzKSkpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBkb2NzO1xufTsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/cozy-sharing/dist/state.js\n");

/***/ })

})