webpackHotUpdate("vendors",{

/***/ "./node_modules/cozy-sharing/dist/state.js":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"receiveSharings\", function() { return receiveSharings; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"addSharing\", function() { return addSharing; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"updateSharing\", function() { return updateSharing; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"revokeRecipient\", function() { return revokeRecipient; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"revokeSelf\", function() { return revokeSelf; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"addSharingLink\", function() { return addSharingLink; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"updateSharingLink\", function() { return updateSharingLink; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"revokeSharingLink\", function() { return revokeSharingLink; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"receivePaths\", function() { return receivePaths; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"matchingInstanceName\", function() { return matchingInstanceName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isOwner\", function() { return isOwner; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"canReshare\", function() { return canReshare; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getOwner\", function() { return getOwner; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getRecipients\", function() { return getRecipients; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharingLink\", function() { return getSharingLink; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharingForSelf\", function() { return getSharingForSelf; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharingType\", function() { return getSharingType; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getDocumentSharing\", function() { return getDocumentSharing; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharingById\", function() { return getSharingById; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getDocumentPermissions\", function() { return getDocumentPermissions; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"hasSharedParent\", function() { return hasSharedParent; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"hasSharedChild\", function() { return hasSharedChild; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharedParentPath\", function() { return getSharedParentPath; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharedDocIds\", function() { return getSharedDocIds; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharingDocIds\", function() { return getSharingDocIds; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getExternalSharingIds\", function() { return getExternalSharingIds; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getPermissionDocIds\", function() { return getPermissionDocIds; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getDocumentSharingType\", function() { return getDocumentSharingType; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"isReadOnlySharing\", function() { return isReadOnlySharing; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getSharedDocIdsBySharings\", function() { return getSharedDocIdsBySharings; });\n/* harmony import */ var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"./node_modules/@babel/runtime/helpers/toConsumableArray.js\");\n/* harmony import */ var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_helpers_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"./node_modules/@babel/runtime/helpers/objectWithoutProperties.js\");\n/* harmony import */ var _babel_runtime_helpers_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(\"./node_modules/@babel/runtime/helpers/defineProperty.js\");\n/* harmony import */ var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var lodash_get__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(\"./node_modules/lodash/get.js\");\n/* harmony import */ var lodash_get__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(lodash_get__WEBPACK_IMPORTED_MODULE_3__);\n\n\n\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default()(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\n\nvar RECEIVE_SHARINGS = 'RECEIVE_SHARINGS';\nvar ADD_SHARING = 'ADD_SHARING';\nvar UPDATE_SHARING = 'UPDATE_SHARING';\nvar REVOKE_RECIPIENT = 'REVOKE_RECIPIENT';\nvar REVOKE_SELF = 'REVOKE_SELF';\nvar ADD_SHARING_LINK = 'ADD_SHARING_LINK';\nvar UPDATE_SHARING_LINK = 'UPDATE_SHARING_LINK';\nvar REVOKE_SHARING_LINK = 'REVOKE_SHARING_LINK';\nvar RECEIVE_PATHS = 'RECEIVE_PATHS'; // actions\n\nvar receiveSharings = function receiveSharings(_ref) {\n  var instanceUri = _ref.instanceUri,\n      _ref$sharings = _ref.sharings,\n      sharings = _ref$sharings === void 0 ? [] : _ref$sharings,\n      _ref$permissions = _ref.permissions,\n      permissions = _ref$permissions === void 0 ? [] : _ref$permissions,\n      _ref$apps = _ref.apps,\n      apps = _ref$apps === void 0 ? [] : _ref$apps;\n  return {\n    type: RECEIVE_SHARINGS,\n    data: {\n      sharings: sharings.filter(function (s) {\n        console.log(s);\n        return !areAllRecipientsRevoked(s) && !hasBeenSelfRevoked(s, instanceUri);\n      }),\n      permissions: permissions,\n      apps: apps\n    }\n  };\n};\nvar addSharing = function addSharing(data, path) {\n  return {\n    type: ADD_SHARING,\n    data: data,\n    path: path\n  };\n};\nvar updateSharing = function updateSharing(sharing) {\n  return {\n    type: UPDATE_SHARING,\n    sharing: sharing\n  };\n};\nvar revokeRecipient = function revokeRecipient(sharing, index, path) {\n  return {\n    type: REVOKE_RECIPIENT,\n\n    /* We set revoked status to the revoked member.\n    We can't just simply remove it, 'cauz we use the index\n    to remove members..\n    */\n    sharing: _objectSpread(_objectSpread({}, sharing), {}, {\n      attributes: _objectSpread(_objectSpread({}, sharing.attributes), {}, {\n        members: sharing.attributes.members.map(function (m, idx) {\n          if (idx === index) {\n            return _objectSpread(_objectSpread({}, m), {}, {\n              status: 'revoked'\n            });\n          }\n\n          return m;\n        })\n      })\n    }),\n    path: path\n  };\n};\nvar revokeSelf = function revokeSelf(sharing) {\n  return {\n    type: REVOKE_SELF,\n    sharing: sharing\n  };\n};\nvar addSharingLink = function addSharingLink(data) {\n  return {\n    type: ADD_SHARING_LINK,\n    data: data\n  };\n};\nvar updateSharingLink = function updateSharingLink(data) {\n  return {\n    type: UPDATE_SHARING_LINK,\n    data: data\n  };\n};\nvar revokeSharingLink = function revokeSharingLink(permissions) {\n  return {\n    type: REVOKE_SHARING_LINK,\n    permissions: permissions\n  };\n};\nvar receivePaths = function receivePaths(paths) {\n  return {\n    type: RECEIVE_PATHS,\n    paths: paths\n  };\n};\nvar matchingInstanceName = function matchingInstanceName() {\n  var instanceUri = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  return function (shareMember) {\n    return shareMember.instance && shareMember.instance.toString().toLowerCase() === instanceUri.toLowerCase();\n  };\n}; // reducers\n\nvar byIdInitialState = {\n  sharings: [],\n  permissions: []\n};\n\nvar isItemEmpty = function isItemEmpty(item) {\n  return item.sharings.length === 0 && item.permissions.length === 0;\n};\n\nvar updateByIdItem = function updateByIdItem(state, id, updater) {\n  var byIdState = state[id],\n      rest = _babel_runtime_helpers_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_1___default()(state, [id].map(_toPropertyKey));\n\n  var update = updater(byIdState || byIdInitialState);\n  return isItemEmpty(update) ? rest : _objectSpread(_objectSpread({}, rest), {}, _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_2___default()({}, id, update));\n};\n\nvar indexSharing = function indexSharing() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var sharing = arguments.length > 1 ? arguments[1] : undefined;\n  var sharedDocs = getSharedDocIds(sharing);\n  return sharedDocs.reduce(function (byId, id) {\n    var updatedByIdItem = updateByIdItem(byId, id, function (state) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        // todo index by id instead of having an array\n        sharings: Object.values(state.sharings).includes(sharing.id) ? _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(state.sharings) : [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(state.sharings), [sharing.id])\n      });\n    });\n    return updatedByIdItem;\n  }, state);\n};\n\nvar forgetSharing = function forgetSharing() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var sharing = arguments.length > 1 ? arguments[1] : undefined;\n  return getSharedDocIds(sharing).reduce(function (byId, id) {\n    return updateByIdItem(byId, id, function (state) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        sharings: state.sharings.filter(function (sid) {\n          return sid !== sharing.id;\n        })\n      });\n    });\n  }, state);\n};\n\nvar indexPermission = function indexPermission() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var perm = arguments.length > 1 ? arguments[1] : undefined;\n  return getSharedDocIds(perm).reduce(function (byId, id) {\n    return updateByIdItem(byId, id, function (state) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        permissions: [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(state.permissions), [perm.id])\n      });\n    });\n  }, state);\n};\n\nvar forgetPermission = function forgetPermission() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var permission = arguments.length > 1 ? arguments[1] : undefined;\n  return getSharedDocIds(permission).reduce(function (byId, id) {\n    return updateByIdItem(byId, id, function (state) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        permissions: state.permissions.filter(function (pid) {\n          return pid !== permission.id;\n        })\n      });\n    });\n  }, state);\n};\n\nvar byDocId = function byDocId() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case RECEIVE_SHARINGS:\n      // eslint-disable-next-line no-case-declarations\n      var intermediaryState = action.data.sharings.reduce(function (byId, sharing) {\n        return indexSharing(byId, sharing);\n      }, state);\n      return action.data.permissions.reduce(function (byId, perm) {\n        return indexPermission(byId, perm);\n      }, intermediaryState);\n\n    case ADD_SHARING:\n      return indexSharing(state, action.data);\n\n    case REVOKE_RECIPIENT:\n    case UPDATE_SHARING:\n      if (areAllRecipientsRevoked(action.sharing)) {\n        return forgetSharing(state, action.sharing);\n      }\n\n      return state;\n\n    case ADD_SHARING_LINK:\n      if (!Array.isArray(action.data)) {\n        return indexPermission(state, action.data);\n      } else {\n        var clonedState = _objectSpread({}, state);\n\n        action.data.map(function (s) {\n          clonedState = _objectSpread({}, indexPermission(clonedState, s));\n        });\n        return clonedState;\n      }\n\n    case REVOKE_SELF:\n      return forgetSharing(state, action.sharing);\n\n    case REVOKE_SHARING_LINK:\n      return action.permissions.reduce(function (byId, perm) {\n        return forgetPermission(byId, perm);\n      }, state);\n\n    default:\n      return state;\n  }\n};\n\nvar permissions = function permissions() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case RECEIVE_SHARINGS:\n      return action.data.permissions;\n\n    case ADD_SHARING_LINK:\n      if (!Array.isArray(action.data)) {\n        return [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(state), [action.data]);\n      } else {\n        return [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(state), _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(action.data));\n      }\n\n    case UPDATE_SHARING_LINK:\n      return state.map(function (p) {\n        return p.id === action.data.id ? action.data : p;\n      });\n\n    case REVOKE_SHARING_LINK:\n      // eslint-disable-next-line no-case-declarations\n      var permIds = action.permissions.map(function (p) {\n        return p.id;\n      });\n      return state.filter(function (p) {\n        return permIds.indexOf(p.id) === -1;\n      });\n\n    default:\n      return state;\n  }\n};\n\nvar apps = function apps() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case RECEIVE_SHARINGS:\n      return action.data.apps;\n\n    default:\n      return state;\n  }\n};\n\nvar sharings = function sharings() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case RECEIVE_SHARINGS:\n      return action.data.sharings;\n\n    case ADD_SHARING:\n      // be sure that we're not adding the sharing twice\n      // can be the case if we launch the create and\n      // receive the realtime in the same time\n      // TODO Index by index...\n      // eslint-disable-next-line\n      var filtered_state = state.filter(function (s) {\n        return s.id !== action.data.id;\n      });\n      return [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(filtered_state), [action.data]);\n\n    case UPDATE_SHARING:\n    case REVOKE_RECIPIENT:\n      return state.map(function (s) {\n        return s.id !== action.sharing.id ? s : action.sharing;\n      });\n\n    case REVOKE_SELF:\n      return state.filter(function (s) {\n        return s.id !== action.sharing.id;\n      });\n\n    default:\n      return state;\n  }\n};\n\nvar sharedPaths = function sharedPaths() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case RECEIVE_PATHS:\n      // !TODO Remove after we solved the sharedPaths bugs\n      // eslint-disable-next-line\n      return action.paths;\n\n    case ADD_SHARING:\n      // !TODO Remove after we solved the sharedPaths bugs\n      // eslint-disable-next-line\n      var newState = [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(state), [action.path]);\n      return newState;\n\n    case REVOKE_RECIPIENT:\n      if (areAllRecipientsRevoked(action.sharing)) {\n        return state.filter(function (p) {\n          return p !== action.path;\n        });\n      }\n\n      return state;\n\n    default:\n      return state;\n  }\n};\n\nvar reducer = function reducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var action = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return {\n    byDocId: byDocId(state.byDocId, action),\n    sharings: sharings(state.sharings, action),\n    permissions: permissions(state.permissions, action),\n    apps: apps(state.apps, action),\n    sharedPaths: sharedPaths(state.sharedPaths, action)\n  };\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (reducer); // selectors\n\nvar isOwner = function isOwner(state, docId) {\n  if (state.byDocId[docId] && state.byDocId[docId].sharings.length !== 0) {\n    return getSharingById(state, state.byDocId[docId].sharings[0]).attributes.owner === true;\n  }\n\n  return true;\n};\nvar canReshare = function canReshare(state, docId, instanceUri) {\n  var sharing = getDocumentSharing(state, docId);\n  var me = sharing.attributes.members.find(matchingInstanceName(instanceUri));\n  return sharing.attributes.open_sharing === true && me && !me.read_only;\n};\nvar getOwner = function getOwner(state, docId) {\n  return getRecipients(state, docId).find(function (r) {\n    return r.status === 'owner';\n  });\n};\nvar getRecipients = function getRecipients(state, docId) {\n  var recipients = getDocumentSharings(state, docId).map(function (sharing) {\n    var type = getDocumentSharingType(sharing, docId);\n    return sharing.attributes.members.map(function (m, idx) {\n      return _objectSpread(_objectSpread({}, m), {}, {\n        type: m.read_only ? 'one-way' : type,\n        sharingId: sharing.id,\n        index: idx,\n        avatarPath: \"/sharings/\".concat(sharing.id, \"/recipients/\").concat(idx, \"/avatar\")\n      });\n    });\n  }).reduce(function (acc, member) {\n    return acc.concat(member);\n  }, []).filter(function (r) {\n    return r.status !== 'revoked';\n  });\n\n  if (recipients[0] && recipients[0].status === 'owner') {\n    return [recipients[0]].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(recipients.filter(function (r) {\n      return r.status !== 'owner';\n    })));\n  }\n\n  return recipients;\n};\nvar getSharingLink = function getSharingLink(state, docId, documentType) {\n  // This shouldn't have happened, but unfortunately some duplicate sharing links have been created in the past\n  var perms = getDocumentPermissions(state, docId);\n  if (perms.length === 0) return null;\n  var perm = perms[0]; // We used to use `email` as `codes` attribute for a sharingByLink.\n  // But when we use cozy-client to create a Permission, by default\n  // the codes attribute is set to `code`. MesPapiers app is using this\n  // default behavior... So the sharing by link created by mes papiers\n  // didn't appear correctly in cozy-sharing.\n  // This is a bit ugly, we should have a better way to know if this is\n  // a sharing by link or not.\n\n  var code = lodash_get__WEBPACK_IMPORTED_MODULE_3___default()(perm, 'attributes.shortcodes.email') || lodash_get__WEBPACK_IMPORTED_MODULE_3___default()(perm, 'attributes.shortcodes.code') || lodash_get__WEBPACK_IMPORTED_MODULE_3___default()(perm, 'attributes.codes.email') || lodash_get__WEBPACK_IMPORTED_MODULE_3___default()(perm, 'attributes.codes.code');\n\n  if (code) {\n    return buildSharingLink(state, documentType, code);\n  } else {\n    return null;\n  }\n};\nvar getSharingForSelf = function getSharingForSelf(state, docId) {\n  return getDocumentSharing(state, docId);\n};\nvar getSharingType = function getSharingType(state, docId, instanceUri) {\n  var sharing = getSharingForSelf(state, docId);\n  if (!sharing) return false;\n  var type = getDocumentSharingType(sharing, docId);\n  if (sharing.attributes.owner) return type;\n  var me = sharing.attributes.members.find(matchingInstanceName(instanceUri));\n  return me && me.read_only ? 'one-way' : type;\n};\nvar getDocumentSharing = function getDocumentSharing(state, docId) {\n  return getDocumentSharings(state, docId)[0] || null;\n};\n\nvar getDocumentSharings = function getDocumentSharings(state, docId) {\n  return !state.byDocId[docId] ? [] : state.byDocId[docId].sharings.map(function (id) {\n    return getSharingById(state, id);\n  });\n};\n\nvar getSharingById = function getSharingById(state, id) {\n  return state.sharings.find(function (s) {\n    return s.id === id;\n  });\n};\nvar getDocumentPermissions = function getDocumentPermissions(state, docId) {\n  return !state.byDocId[docId] ? [] : state.byDocId[docId].permissions.map(function (id) {\n    return getPermissionById(state, id);\n  });\n};\n\nvar getPermissionById = function getPermissionById(state, id) {\n  return state.permissions.find(function (s) {\n    return s.id === id;\n  });\n};\n\nvar getApps = function getApps(state) {\n  return state.apps;\n};\n\nvar hasSharedParent = function hasSharedParent(state, documentPath) {\n  if (!state.sharedPaths) {\n    return false; // hasSharedParent should not occur\n  }\n\n  return state.sharedPaths.some(function (path) {\n    return documentPath.indexOf(\"\".concat(path, \"/\")) === 0;\n  });\n};\nvar hasSharedChild = function hasSharedChild(state, documentPath) {\n  if (!state.sharedPaths) {\n    return false; // hasSharedChild should not occur\n  }\n\n  var ret = state.sharedPaths.some(function (path) {\n    return path.indexOf(\"\".concat(documentPath, \"/\")) === 0;\n  });\n  return ret;\n};\n/**\n * Returns the path of the shared parent for a given document\n * @param {object} state - Redux state\n * @param {string} documentPath - Path of the given document\n * @returns {string|null} Path of the shared parent\n */\n\nvar getSharedParentPath = function getSharedParentPath(state, documentPath) {\n  if (hasSharedParent(state, documentPath)) {\n    return state.sharedPaths.find(function (path) {\n      return documentPath.startsWith(path);\n    });\n  }\n\n  return null;\n}; // helpers\n\nvar getSharedDocIds = function getSharedDocIds(doc) {\n  return doc.type === 'io.cozy.sharings' ? getSharingDocIds(doc) : getPermissionDocIds(doc);\n};\nvar getSharingDocIds = function getSharingDocIds(sharing) {\n  var docs = sharing.attributes.rules.map(function (r) {\n    return r.values;\n  }).reduce(function (acc, val) {\n    return acc.concat(val);\n  }, []);\n\n  if (sharing.attributes.shortcut_id) {\n    docs.push(sharing.attributes.shortcut_id);\n  }\n\n  return docs;\n};\n/**\n * Get ids of shared documents, but only if sharing is ready so files exist\n * @param {object} sharing\n * @param {string} instanceUri\n * @returns {string[]} List of document ids of a sharing\n */\n\nvar getExternalSharingIds = function getExternalSharingIds(sharing, instanceUri) {\n  var member = sharing.attributes.members.find(function (member) {\n    return member.instance === instanceUri;\n  });\n  var docs = [];\n\n  if ((member === null || member === void 0 ? void 0 : member.status) === 'ready') {\n    docs = sharing.attributes.rules.map(function (r) {\n      return r.values;\n    }).reduce(function (acc, val) {\n      return acc.concat(val);\n    }, []);\n  }\n\n  if (sharing.attributes.shortcut_id) {\n    docs.push(sharing.attributes.shortcut_id);\n  }\n\n  return docs;\n}; // Some permissions can not have values since they can\n// be on a global doctype. In that case, we can't sort\n// them by id\n\nvar getPermissionDocIds = function getPermissionDocIds(perm) {\n  return Object.keys(perm.attributes.permissions).map(function (k) {\n    return perm.attributes.permissions[k].values ? perm.attributes.permissions[k].values : [];\n  }).reduce(function (acc, val) {\n    return [].concat(_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(acc), _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(val));\n  }, []);\n};\n\nvar areAllRecipientsRevoked = function areAllRecipientsRevoked(sharing) {\n  return sharing.attributes.owner && sharing.attributes.members.filter(function (m) {\n    return m.status !== 'revoked';\n  }).length === 1;\n};\n\nvar hasBeenSelfRevoked = function hasBeenSelfRevoked(sharing, instanceUri) {\n  var me = sharing.attributes.members.find(matchingInstanceName(instanceUri));\n  return !sharing.attributes.owner && me && me.status === 'revoked';\n};\n/**\n * Returns the sharing rule of a document\n * @param {object} sharing - The sharing\n * @param {string} docId - Id of the shared document\n * @returns {object} sharing rule\n */\n\n\nvar getSharingRule = function getSharingRule(sharing, docId) {\n  return sharing.attributes.rules.find(function (r) {\n    return r.values.indexOf(docId) !== -1;\n  });\n};\n/**\n * Returns the sharing type of a directory\n * @param {object} rule - Sharing rule of a document\n * @returns {string} two-way or one-way\n */\n\n\nvar getDirectorySharingType = function getDirectorySharingType(rule) {\n  // If a document has no rule, it is a shortcut preview of a sharing.\n  // Since the sharing hasn't been accepted, it can't be synced so we return the \"one-way\" type.\n  // TODO : the sharing type shouldn't be based on rule but on ready_only prop of the member\n  return rule && rule.update === 'sync' && rule.remove === 'sync' ? 'two-way' : 'one-way';\n};\n/**\n * Returns the sharing type of a file\n * @param {object} rule - Sharing rule of a document\n * @returns {string} two-way or one-way\n */\n\n\nvar getFileSharingType = function getFileSharingType(rule) {\n  // If a document has no rule, it is a shortcut preview of a sharing.\n  // Since the sharing hasn't been accepted, it can't be synced so we return the \"one-way\" type.\n  // TODO : the sharing type shouldn't be based on rule but on ready_only prop of the member\n  return rule && rule.update === 'sync' && rule.remove === 'revoke' ? 'two-way' : 'one-way';\n};\n/**\n * Returns the sharing type of a document\n * @param {object} sharing - The sharing\n * @param {string} docId - Id of the shared document\n * @returns {string} two-way or one-way\n */\n\n\nvar getDocumentSharingType = function getDocumentSharingType(sharing, docId) {\n  if (!sharing) return null;\n  var rule = getSharingRule(sharing, docId);\n  var directorySharingType = getDirectorySharingType(rule);\n  var fileSharingType = getFileSharingType(rule);\n  return directorySharingType === 'two-way' || fileSharingType === 'two-way' ? 'two-way' : 'one-way';\n};\nvar isReadOnlySharing = function isReadOnlySharing(sharing, docId) {\n  var rule = getSharingRule(sharing, docId);\n  var directorySharingType = getDirectorySharingType(rule);\n  var fileSharingType = getFileSharingType(rule);\n  return directorySharingType === 'two-way' || fileSharingType === 'two-way' ? false : true;\n};\n\nvar buildSharingLink = function buildSharingLink(state, documentType, sharecode) {\n  var appUrl = getAppUrlForDoctype(state, documentType);\n\n  switch (documentType) {\n    case 'Notes':\n      return \"\".concat(appUrl, \"public/?sharecode=\").concat(sharecode);\n\n    default:\n      return \"\".concat(appUrl, \"public?sharecode=\").concat(sharecode);\n  }\n};\n\nvar getAppUrlForDoctype = function getAppUrlForDoctype(state, documentType) {\n  var apps = getApps(state);\n\n  switch (documentType) {\n    case 'Notes':\n      return getAppUrl(apps, 'notes');\n\n    case 'Files':\n    case 'Document':\n      return getAppUrl(apps, 'drive');\n\n    case 'Albums':\n      return getAppUrl(apps, 'photos');\n\n    default:\n      throw new Error(\"Sharing link: don't know which app to use for doctype \".concat(documentType));\n  }\n};\n\nvar getAppUrl = function getAppUrl(apps, appName) {\n  var app = apps.find(function (a) {\n    return a.attributes.slug === appName && a.attributes.state === 'ready';\n  });\n\n  if (!app) {\n    throw new Error(\"Sharing link: app \".concat(appName, \" not installed\"));\n  }\n\n  return app.links.related;\n};\n/**\n *\n * @param {SharingCollection} sharings\n * @return {Array} Array of docIds\n */\n\n\nvar getSharedDocIdsBySharings = function getSharedDocIdsBySharings(sharings) {\n  var docs = [];\n  if (!sharings.data) return [];\n  sharings.data.forEach(function (s) {\n    if (s.attributes && s.attributes.active) {\n      docs.push.apply(docs, _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_0___default()(getSharingDocIds(s)));\n    }\n  });\n  return docs;\n};//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvY296eS1zaGFyaW5nL2Rpc3Qvc3RhdGUuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvY296eS1zaGFyaW5nL2Rpc3Qvc3RhdGUuanM/OTcwYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL3RvQ29uc3VtYWJsZUFycmF5XCI7XG5pbXBvcnQgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzIGZyb20gXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzXCI7XG5pbXBvcnQgX2RlZmluZVByb3BlcnR5IGZyb20gXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2RlZmluZVByb3BlcnR5XCI7XG5cbmZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykgeyB2YXIga2V5ID0gX3RvUHJpbWl0aXZlKGFyZywgXCJzdHJpbmdcIik7IHJldHVybiB0eXBlb2Yga2V5ID09PSBcInN5bWJvbFwiID8ga2V5IDogU3RyaW5nKGtleSk7IH1cblxuZnVuY3Rpb24gX3RvUHJpbWl0aXZlKGlucHV0LCBoaW50KSB7IGlmICh0eXBlb2YgaW5wdXQgIT09IFwib2JqZWN0XCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDsgdmFyIHByaW0gPSBpbnB1dFtTeW1ib2wudG9QcmltaXRpdmVdOyBpZiAocHJpbSAhPT0gdW5kZWZpbmVkKSB7IHZhciByZXMgPSBwcmltLmNhbGwoaW5wdXQsIGhpbnQgfHwgXCJkZWZhdWx0XCIpOyBpZiAodHlwZW9mIHJlcyAhPT0gXCJvYmplY3RcIikgcmV0dXJuIHJlczsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkBAdG9QcmltaXRpdmUgbXVzdCByZXR1cm4gYSBwcmltaXRpdmUgdmFsdWUuXCIpOyB9IHJldHVybiAoaGludCA9PT0gXCJzdHJpbmdcIiA/IFN0cmluZyA6IE51bWJlcikoaW5wdXQpOyB9XG5cbmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBlbnVtZXJhYmxlT25seSAmJiAoc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pKSwga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9XG5cbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBudWxsICE9IGFyZ3VtZW50c1tpXSA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpICUgMiA/IG93bktleXMoT2JqZWN0KHNvdXJjZSksICEwKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpIDogb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihzb3VyY2UsIGtleSkpOyB9KTsgfSByZXR1cm4gdGFyZ2V0OyB9XG5cbmltcG9ydCBnZXQgZnJvbSAnbG9kYXNoL2dldCc7XG52YXIgUkVDRUlWRV9TSEFSSU5HUyA9ICdSRUNFSVZFX1NIQVJJTkdTJztcbnZhciBBRERfU0hBUklORyA9ICdBRERfU0hBUklORyc7XG52YXIgVVBEQVRFX1NIQVJJTkcgPSAnVVBEQVRFX1NIQVJJTkcnO1xudmFyIFJFVk9LRV9SRUNJUElFTlQgPSAnUkVWT0tFX1JFQ0lQSUVOVCc7XG52YXIgUkVWT0tFX1NFTEYgPSAnUkVWT0tFX1NFTEYnO1xudmFyIEFERF9TSEFSSU5HX0xJTksgPSAnQUREX1NIQVJJTkdfTElOSyc7XG52YXIgVVBEQVRFX1NIQVJJTkdfTElOSyA9ICdVUERBVEVfU0hBUklOR19MSU5LJztcbnZhciBSRVZPS0VfU0hBUklOR19MSU5LID0gJ1JFVk9LRV9TSEFSSU5HX0xJTksnO1xudmFyIFJFQ0VJVkVfUEFUSFMgPSAnUkVDRUlWRV9QQVRIUyc7IC8vIGFjdGlvbnNcblxuZXhwb3J0IHZhciByZWNlaXZlU2hhcmluZ3MgPSBmdW5jdGlvbiByZWNlaXZlU2hhcmluZ3MoX3JlZikge1xuICB2YXIgaW5zdGFuY2VVcmkgPSBfcmVmLmluc3RhbmNlVXJpLFxuICAgICAgX3JlZiRzaGFyaW5ncyA9IF9yZWYuc2hhcmluZ3MsXG4gICAgICBzaGFyaW5ncyA9IF9yZWYkc2hhcmluZ3MgPT09IHZvaWQgMCA/IFtdIDogX3JlZiRzaGFyaW5ncyxcbiAgICAgIF9yZWYkcGVybWlzc2lvbnMgPSBfcmVmLnBlcm1pc3Npb25zLFxuICAgICAgcGVybWlzc2lvbnMgPSBfcmVmJHBlcm1pc3Npb25zID09PSB2b2lkIDAgPyBbXSA6IF9yZWYkcGVybWlzc2lvbnMsXG4gICAgICBfcmVmJGFwcHMgPSBfcmVmLmFwcHMsXG4gICAgICBhcHBzID0gX3JlZiRhcHBzID09PSB2b2lkIDAgPyBbXSA6IF9yZWYkYXBwcztcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiBSRUNFSVZFX1NIQVJJTkdTLFxuICAgIGRhdGE6IHtcbiAgICAgIHNoYXJpbmdzOiBzaGFyaW5ncy5maWx0ZXIoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgY29uc29sZS5sb2cocyk7XG4gICAgICAgIHJldHVybiAhYXJlQWxsUmVjaXBpZW50c1Jldm9rZWQocykgJiYgIWhhc0JlZW5TZWxmUmV2b2tlZChzLCBpbnN0YW5jZVVyaSk7XG4gICAgICB9KSxcbiAgICAgIHBlcm1pc3Npb25zOiBwZXJtaXNzaW9ucyxcbiAgICAgIGFwcHM6IGFwcHNcbiAgICB9XG4gIH07XG59O1xuZXhwb3J0IHZhciBhZGRTaGFyaW5nID0gZnVuY3Rpb24gYWRkU2hhcmluZyhkYXRhLCBwYXRoKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogQUREX1NIQVJJTkcsXG4gICAgZGF0YTogZGF0YSxcbiAgICBwYXRoOiBwYXRoXG4gIH07XG59O1xuZXhwb3J0IHZhciB1cGRhdGVTaGFyaW5nID0gZnVuY3Rpb24gdXBkYXRlU2hhcmluZyhzaGFyaW5nKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogVVBEQVRFX1NIQVJJTkcsXG4gICAgc2hhcmluZzogc2hhcmluZ1xuICB9O1xufTtcbmV4cG9ydCB2YXIgcmV2b2tlUmVjaXBpZW50ID0gZnVuY3Rpb24gcmV2b2tlUmVjaXBpZW50KHNoYXJpbmcsIGluZGV4LCBwYXRoKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogUkVWT0tFX1JFQ0lQSUVOVCxcblxuICAgIC8qIFdlIHNldCByZXZva2VkIHN0YXR1cyB0byB0aGUgcmV2b2tlZCBtZW1iZXIuXG4gICAgV2UgY2FuJ3QganVzdCBzaW1wbHkgcmVtb3ZlIGl0LCAnY2F1eiB3ZSB1c2UgdGhlIGluZGV4XG4gICAgdG8gcmVtb3ZlIG1lbWJlcnMuLlxuICAgICovXG4gICAgc2hhcmluZzogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBzaGFyaW5nKSwge30sIHtcbiAgICAgIGF0dHJpYnV0ZXM6IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc2hhcmluZy5hdHRyaWJ1dGVzKSwge30sIHtcbiAgICAgICAgbWVtYmVyczogc2hhcmluZy5hdHRyaWJ1dGVzLm1lbWJlcnMubWFwKGZ1bmN0aW9uIChtLCBpZHgpIHtcbiAgICAgICAgICBpZiAoaWR4ID09PSBpbmRleCkge1xuICAgICAgICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgbSksIHt9LCB7XG4gICAgICAgICAgICAgIHN0YXR1czogJ3Jldm9rZWQnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gbTtcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSksXG4gICAgcGF0aDogcGF0aFxuICB9O1xufTtcbmV4cG9ydCB2YXIgcmV2b2tlU2VsZiA9IGZ1bmN0aW9uIHJldm9rZVNlbGYoc2hhcmluZykge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFJFVk9LRV9TRUxGLFxuICAgIHNoYXJpbmc6IHNoYXJpbmdcbiAgfTtcbn07XG5leHBvcnQgdmFyIGFkZFNoYXJpbmdMaW5rID0gZnVuY3Rpb24gYWRkU2hhcmluZ0xpbmsoZGF0YSkge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IEFERF9TSEFSSU5HX0xJTkssXG4gICAgZGF0YTogZGF0YVxuICB9O1xufTtcbmV4cG9ydCB2YXIgdXBkYXRlU2hhcmluZ0xpbmsgPSBmdW5jdGlvbiB1cGRhdGVTaGFyaW5nTGluayhkYXRhKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogVVBEQVRFX1NIQVJJTkdfTElOSyxcbiAgICBkYXRhOiBkYXRhXG4gIH07XG59O1xuZXhwb3J0IHZhciByZXZva2VTaGFyaW5nTGluayA9IGZ1bmN0aW9uIHJldm9rZVNoYXJpbmdMaW5rKHBlcm1pc3Npb25zKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogUkVWT0tFX1NIQVJJTkdfTElOSyxcbiAgICBwZXJtaXNzaW9uczogcGVybWlzc2lvbnNcbiAgfTtcbn07XG5leHBvcnQgdmFyIHJlY2VpdmVQYXRocyA9IGZ1bmN0aW9uIHJlY2VpdmVQYXRocyhwYXRocykge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IFJFQ0VJVkVfUEFUSFMsXG4gICAgcGF0aHM6IHBhdGhzXG4gIH07XG59O1xuZXhwb3J0IHZhciBtYXRjaGluZ0luc3RhbmNlTmFtZSA9IGZ1bmN0aW9uIG1hdGNoaW5nSW5zdGFuY2VOYW1lKCkge1xuICB2YXIgaW5zdGFuY2VVcmkgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICcnO1xuICByZXR1cm4gZnVuY3Rpb24gKHNoYXJlTWVtYmVyKSB7XG4gICAgcmV0dXJuIHNoYXJlTWVtYmVyLmluc3RhbmNlICYmIHNoYXJlTWVtYmVyLmluc3RhbmNlLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA9PT0gaW5zdGFuY2VVcmkudG9Mb3dlckNhc2UoKTtcbiAgfTtcbn07IC8vIHJlZHVjZXJzXG5cbnZhciBieUlkSW5pdGlhbFN0YXRlID0ge1xuICBzaGFyaW5nczogW10sXG4gIHBlcm1pc3Npb25zOiBbXVxufTtcblxudmFyIGlzSXRlbUVtcHR5ID0gZnVuY3Rpb24gaXNJdGVtRW1wdHkoaXRlbSkge1xuICByZXR1cm4gaXRlbS5zaGFyaW5ncy5sZW5ndGggPT09IDAgJiYgaXRlbS5wZXJtaXNzaW9ucy5sZW5ndGggPT09IDA7XG59O1xuXG52YXIgdXBkYXRlQnlJZEl0ZW0gPSBmdW5jdGlvbiB1cGRhdGVCeUlkSXRlbShzdGF0ZSwgaWQsIHVwZGF0ZXIpIHtcbiAgdmFyIGJ5SWRTdGF0ZSA9IHN0YXRlW2lkXSxcbiAgICAgIHJlc3QgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoc3RhdGUsIFtpZF0ubWFwKF90b1Byb3BlcnR5S2V5KSk7XG5cbiAgdmFyIHVwZGF0ZSA9IHVwZGF0ZXIoYnlJZFN0YXRlIHx8IGJ5SWRJbml0aWFsU3RhdGUpO1xuICByZXR1cm4gaXNJdGVtRW1wdHkodXBkYXRlKSA/IHJlc3QgOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHJlc3QpLCB7fSwgX2RlZmluZVByb3BlcnR5KHt9LCBpZCwgdXBkYXRlKSk7XG59O1xuXG52YXIgaW5kZXhTaGFyaW5nID0gZnVuY3Rpb24gaW5kZXhTaGFyaW5nKCkge1xuICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9O1xuICB2YXIgc2hhcmluZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkO1xuICB2YXIgc2hhcmVkRG9jcyA9IGdldFNoYXJlZERvY0lkcyhzaGFyaW5nKTtcbiAgcmV0dXJuIHNoYXJlZERvY3MucmVkdWNlKGZ1bmN0aW9uIChieUlkLCBpZCkge1xuICAgIHZhciB1cGRhdGVkQnlJZEl0ZW0gPSB1cGRhdGVCeUlkSXRlbShieUlkLCBpZCwgZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSksIHt9LCB7XG4gICAgICAgIC8vIHRvZG8gaW5kZXggYnkgaWQgaW5zdGVhZCBvZiBoYXZpbmcgYW4gYXJyYXlcbiAgICAgICAgc2hhcmluZ3M6IE9iamVjdC52YWx1ZXMoc3RhdGUuc2hhcmluZ3MpLmluY2x1ZGVzKHNoYXJpbmcuaWQpID8gX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlLnNoYXJpbmdzKSA6IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoc3RhdGUuc2hhcmluZ3MpLCBbc2hhcmluZy5pZF0pXG4gICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gdXBkYXRlZEJ5SWRJdGVtO1xuICB9LCBzdGF0ZSk7XG59O1xuXG52YXIgZm9yZ2V0U2hhcmluZyA9IGZ1bmN0aW9uIGZvcmdldFNoYXJpbmcoKSB7XG4gIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307XG4gIHZhciBzaGFyaW5nID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7XG4gIHJldHVybiBnZXRTaGFyZWREb2NJZHMoc2hhcmluZykucmVkdWNlKGZ1bmN0aW9uIChieUlkLCBpZCkge1xuICAgIHJldHVybiB1cGRhdGVCeUlkSXRlbShieUlkLCBpZCwgZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBzdGF0ZSksIHt9LCB7XG4gICAgICAgIHNoYXJpbmdzOiBzdGF0ZS5zaGFyaW5ncy5maWx0ZXIoZnVuY3Rpb24gKHNpZCkge1xuICAgICAgICAgIHJldHVybiBzaWQgIT09IHNoYXJpbmcuaWQ7XG4gICAgICAgIH0pXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSwgc3RhdGUpO1xufTtcblxudmFyIGluZGV4UGVybWlzc2lvbiA9IGZ1bmN0aW9uIGluZGV4UGVybWlzc2lvbigpIHtcbiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTtcbiAgdmFyIHBlcm0gPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDtcbiAgcmV0dXJuIGdldFNoYXJlZERvY0lkcyhwZXJtKS5yZWR1Y2UoZnVuY3Rpb24gKGJ5SWQsIGlkKSB7XG4gICAgcmV0dXJuIHVwZGF0ZUJ5SWRJdGVtKGJ5SWQsIGlkLCBmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHN0YXRlKSwge30sIHtcbiAgICAgICAgcGVybWlzc2lvbnM6IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoc3RhdGUucGVybWlzc2lvbnMpLCBbcGVybS5pZF0pXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSwgc3RhdGUpO1xufTtcblxudmFyIGZvcmdldFBlcm1pc3Npb24gPSBmdW5jdGlvbiBmb3JnZXRQZXJtaXNzaW9uKCkge1xuICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9O1xuICB2YXIgcGVybWlzc2lvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkO1xuICByZXR1cm4gZ2V0U2hhcmVkRG9jSWRzKHBlcm1pc3Npb24pLnJlZHVjZShmdW5jdGlvbiAoYnlJZCwgaWQpIHtcbiAgICByZXR1cm4gdXBkYXRlQnlJZEl0ZW0oYnlJZCwgaWQsIGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc3RhdGUpLCB7fSwge1xuICAgICAgICBwZXJtaXNzaW9uczogc3RhdGUucGVybWlzc2lvbnMuZmlsdGVyKGZ1bmN0aW9uIChwaWQpIHtcbiAgICAgICAgICByZXR1cm4gcGlkICE9PSBwZXJtaXNzaW9uLmlkO1xuICAgICAgICB9KVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0sIHN0YXRlKTtcbn07XG5cbnZhciBieURvY0lkID0gZnVuY3Rpb24gYnlEb2NJZCgpIHtcbiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTtcbiAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkO1xuXG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICBjYXNlIFJFQ0VJVkVfU0hBUklOR1M6XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY2FzZS1kZWNsYXJhdGlvbnNcbiAgICAgIHZhciBpbnRlcm1lZGlhcnlTdGF0ZSA9IGFjdGlvbi5kYXRhLnNoYXJpbmdzLnJlZHVjZShmdW5jdGlvbiAoYnlJZCwgc2hhcmluZykge1xuICAgICAgICByZXR1cm4gaW5kZXhTaGFyaW5nKGJ5SWQsIHNoYXJpbmcpO1xuICAgICAgfSwgc3RhdGUpO1xuICAgICAgcmV0dXJuIGFjdGlvbi5kYXRhLnBlcm1pc3Npb25zLnJlZHVjZShmdW5jdGlvbiAoYnlJZCwgcGVybSkge1xuICAgICAgICByZXR1cm4gaW5kZXhQZXJtaXNzaW9uKGJ5SWQsIHBlcm0pO1xuICAgICAgfSwgaW50ZXJtZWRpYXJ5U3RhdGUpO1xuXG4gICAgY2FzZSBBRERfU0hBUklORzpcbiAgICAgIHJldHVybiBpbmRleFNoYXJpbmcoc3RhdGUsIGFjdGlvbi5kYXRhKTtcblxuICAgIGNhc2UgUkVWT0tFX1JFQ0lQSUVOVDpcbiAgICBjYXNlIFVQREFURV9TSEFSSU5HOlxuICAgICAgaWYgKGFyZUFsbFJlY2lwaWVudHNSZXZva2VkKGFjdGlvbi5zaGFyaW5nKSkge1xuICAgICAgICByZXR1cm4gZm9yZ2V0U2hhcmluZyhzdGF0ZSwgYWN0aW9uLnNoYXJpbmcpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc3RhdGU7XG5cbiAgICBjYXNlIEFERF9TSEFSSU5HX0xJTks6XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkoYWN0aW9uLmRhdGEpKSB7XG4gICAgICAgIHJldHVybiBpbmRleFBlcm1pc3Npb24oc3RhdGUsIGFjdGlvbi5kYXRhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBjbG9uZWRTdGF0ZSA9IF9vYmplY3RTcHJlYWQoe30sIHN0YXRlKTtcblxuICAgICAgICBhY3Rpb24uZGF0YS5tYXAoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgICBjbG9uZWRTdGF0ZSA9IF9vYmplY3RTcHJlYWQoe30sIGluZGV4UGVybWlzc2lvbihjbG9uZWRTdGF0ZSwgcykpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNsb25lZFN0YXRlO1xuICAgICAgfVxuXG4gICAgY2FzZSBSRVZPS0VfU0VMRjpcbiAgICAgIHJldHVybiBmb3JnZXRTaGFyaW5nKHN0YXRlLCBhY3Rpb24uc2hhcmluZyk7XG5cbiAgICBjYXNlIFJFVk9LRV9TSEFSSU5HX0xJTks6XG4gICAgICByZXR1cm4gYWN0aW9uLnBlcm1pc3Npb25zLnJlZHVjZShmdW5jdGlvbiAoYnlJZCwgcGVybSkge1xuICAgICAgICByZXR1cm4gZm9yZ2V0UGVybWlzc2lvbihieUlkLCBwZXJtKTtcbiAgICAgIH0sIHN0YXRlKTtcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gc3RhdGU7XG4gIH1cbn07XG5cbnZhciBwZXJtaXNzaW9ucyA9IGZ1bmN0aW9uIHBlcm1pc3Npb25zKCkge1xuICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdO1xuICB2YXIgYWN0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7XG5cbiAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgIGNhc2UgUkVDRUlWRV9TSEFSSU5HUzpcbiAgICAgIHJldHVybiBhY3Rpb24uZGF0YS5wZXJtaXNzaW9ucztcblxuICAgIGNhc2UgQUREX1NIQVJJTkdfTElOSzpcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheShhY3Rpb24uZGF0YSkpIHtcbiAgICAgICAgcmV0dXJuIFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkoc3RhdGUpLCBbYWN0aW9uLmRhdGFdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlKSwgX3RvQ29uc3VtYWJsZUFycmF5KGFjdGlvbi5kYXRhKSk7XG4gICAgICB9XG5cbiAgICBjYXNlIFVQREFURV9TSEFSSU5HX0xJTks6XG4gICAgICByZXR1cm4gc3RhdGUubWFwKGZ1bmN0aW9uIChwKSB7XG4gICAgICAgIHJldHVybiBwLmlkID09PSBhY3Rpb24uZGF0YS5pZCA/IGFjdGlvbi5kYXRhIDogcDtcbiAgICAgIH0pO1xuXG4gICAgY2FzZSBSRVZPS0VfU0hBUklOR19MSU5LOlxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNhc2UtZGVjbGFyYXRpb25zXG4gICAgICB2YXIgcGVybUlkcyA9IGFjdGlvbi5wZXJtaXNzaW9ucy5tYXAoZnVuY3Rpb24gKHApIHtcbiAgICAgICAgcmV0dXJuIHAuaWQ7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBzdGF0ZS5maWx0ZXIoZnVuY3Rpb24gKHApIHtcbiAgICAgICAgcmV0dXJuIHBlcm1JZHMuaW5kZXhPZihwLmlkKSA9PT0gLTE7XG4gICAgICB9KTtcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gc3RhdGU7XG4gIH1cbn07XG5cbnZhciBhcHBzID0gZnVuY3Rpb24gYXBwcygpIHtcbiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTtcbiAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkO1xuXG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICBjYXNlIFJFQ0VJVkVfU0hBUklOR1M6XG4gICAgICByZXR1cm4gYWN0aW9uLmRhdGEuYXBwcztcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gc3RhdGU7XG4gIH1cbn07XG5cbnZhciBzaGFyaW5ncyA9IGZ1bmN0aW9uIHNoYXJpbmdzKCkge1xuICB2YXIgc3RhdGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdO1xuICB2YXIgYWN0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7XG5cbiAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgIGNhc2UgUkVDRUlWRV9TSEFSSU5HUzpcbiAgICAgIHJldHVybiBhY3Rpb24uZGF0YS5zaGFyaW5ncztcblxuICAgIGNhc2UgQUREX1NIQVJJTkc6XG4gICAgICAvLyBiZSBzdXJlIHRoYXQgd2UncmUgbm90IGFkZGluZyB0aGUgc2hhcmluZyB0d2ljZVxuICAgICAgLy8gY2FuIGJlIHRoZSBjYXNlIGlmIHdlIGxhdW5jaCB0aGUgY3JlYXRlIGFuZFxuICAgICAgLy8gcmVjZWl2ZSB0aGUgcmVhbHRpbWUgaW4gdGhlIHNhbWUgdGltZVxuICAgICAgLy8gVE9ETyBJbmRleCBieSBpbmRleC4uLlxuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICB2YXIgZmlsdGVyZWRfc3RhdGUgPSBzdGF0ZS5maWx0ZXIoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgcmV0dXJuIHMuaWQgIT09IGFjdGlvbi5kYXRhLmlkO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShmaWx0ZXJlZF9zdGF0ZSksIFthY3Rpb24uZGF0YV0pO1xuXG4gICAgY2FzZSBVUERBVEVfU0hBUklORzpcbiAgICBjYXNlIFJFVk9LRV9SRUNJUElFTlQ6XG4gICAgICByZXR1cm4gc3RhdGUubWFwKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBzLmlkICE9PSBhY3Rpb24uc2hhcmluZy5pZCA/IHMgOiBhY3Rpb24uc2hhcmluZztcbiAgICAgIH0pO1xuXG4gICAgY2FzZSBSRVZPS0VfU0VMRjpcbiAgICAgIHJldHVybiBzdGF0ZS5maWx0ZXIoZnVuY3Rpb24gKHMpIHtcbiAgICAgICAgcmV0dXJuIHMuaWQgIT09IGFjdGlvbi5zaGFyaW5nLmlkO1xuICAgICAgfSk7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHN0YXRlO1xuICB9XG59O1xuXG52YXIgc2hhcmVkUGF0aHMgPSBmdW5jdGlvbiBzaGFyZWRQYXRocygpIHtcbiAgdmFyIHN0YXRlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTtcbiAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkO1xuXG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICBjYXNlIFJFQ0VJVkVfUEFUSFM6XG4gICAgICAvLyAhVE9ETyBSZW1vdmUgYWZ0ZXIgd2Ugc29sdmVkIHRoZSBzaGFyZWRQYXRocyBidWdzXG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICAgIHJldHVybiBhY3Rpb24ucGF0aHM7XG5cbiAgICBjYXNlIEFERF9TSEFSSU5HOlxuICAgICAgLy8gIVRPRE8gUmVtb3ZlIGFmdGVyIHdlIHNvbHZlZCB0aGUgc2hhcmVkUGF0aHMgYnVnc1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lXG4gICAgICB2YXIgbmV3U3RhdGUgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlKSwgW2FjdGlvbi5wYXRoXSk7XG4gICAgICByZXR1cm4gbmV3U3RhdGU7XG5cbiAgICBjYXNlIFJFVk9LRV9SRUNJUElFTlQ6XG4gICAgICBpZiAoYXJlQWxsUmVjaXBpZW50c1Jldm9rZWQoYWN0aW9uLnNoYXJpbmcpKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5maWx0ZXIoZnVuY3Rpb24gKHApIHtcbiAgICAgICAgICByZXR1cm4gcCAhPT0gYWN0aW9uLnBhdGg7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc3RhdGU7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHN0YXRlO1xuICB9XG59O1xuXG52YXIgcmVkdWNlciA9IGZ1bmN0aW9uIHJlZHVjZXIoKSB7XG4gIHZhciBzdGF0ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge307XG4gIHZhciBhY3Rpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9O1xuICByZXR1cm4ge1xuICAgIGJ5RG9jSWQ6IGJ5RG9jSWQoc3RhdGUuYnlEb2NJZCwgYWN0aW9uKSxcbiAgICBzaGFyaW5nczogc2hhcmluZ3Moc3RhdGUuc2hhcmluZ3MsIGFjdGlvbiksXG4gICAgcGVybWlzc2lvbnM6IHBlcm1pc3Npb25zKHN0YXRlLnBlcm1pc3Npb25zLCBhY3Rpb24pLFxuICAgIGFwcHM6IGFwcHMoc3RhdGUuYXBwcywgYWN0aW9uKSxcbiAgICBzaGFyZWRQYXRoczogc2hhcmVkUGF0aHMoc3RhdGUuc2hhcmVkUGF0aHMsIGFjdGlvbilcbiAgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHJlZHVjZXI7IC8vIHNlbGVjdG9yc1xuXG5leHBvcnQgdmFyIGlzT3duZXIgPSBmdW5jdGlvbiBpc093bmVyKHN0YXRlLCBkb2NJZCkge1xuICBpZiAoc3RhdGUuYnlEb2NJZFtkb2NJZF0gJiYgc3RhdGUuYnlEb2NJZFtkb2NJZF0uc2hhcmluZ3MubGVuZ3RoICE9PSAwKSB7XG4gICAgcmV0dXJuIGdldFNoYXJpbmdCeUlkKHN0YXRlLCBzdGF0ZS5ieURvY0lkW2RvY0lkXS5zaGFyaW5nc1swXSkuYXR0cmlidXRlcy5vd25lciA9PT0gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufTtcbmV4cG9ydCB2YXIgY2FuUmVzaGFyZSA9IGZ1bmN0aW9uIGNhblJlc2hhcmUoc3RhdGUsIGRvY0lkLCBpbnN0YW5jZVVyaSkge1xuICB2YXIgc2hhcmluZyA9IGdldERvY3VtZW50U2hhcmluZyhzdGF0ZSwgZG9jSWQpO1xuICB2YXIgbWUgPSBzaGFyaW5nLmF0dHJpYnV0ZXMubWVtYmVycy5maW5kKG1hdGNoaW5nSW5zdGFuY2VOYW1lKGluc3RhbmNlVXJpKSk7XG4gIHJldHVybiBzaGFyaW5nLmF0dHJpYnV0ZXMub3Blbl9zaGFyaW5nID09PSB0cnVlICYmIG1lICYmICFtZS5yZWFkX29ubHk7XG59O1xuZXhwb3J0IHZhciBnZXRPd25lciA9IGZ1bmN0aW9uIGdldE93bmVyKHN0YXRlLCBkb2NJZCkge1xuICByZXR1cm4gZ2V0UmVjaXBpZW50cyhzdGF0ZSwgZG9jSWQpLmZpbmQoZnVuY3Rpb24gKHIpIHtcbiAgICByZXR1cm4gci5zdGF0dXMgPT09ICdvd25lcic7XG4gIH0pO1xufTtcbmV4cG9ydCB2YXIgZ2V0UmVjaXBpZW50cyA9IGZ1bmN0aW9uIGdldFJlY2lwaWVudHMoc3RhdGUsIGRvY0lkKSB7XG4gIHZhciByZWNpcGllbnRzID0gZ2V0RG9jdW1lbnRTaGFyaW5ncyhzdGF0ZSwgZG9jSWQpLm1hcChmdW5jdGlvbiAoc2hhcmluZykge1xuICAgIHZhciB0eXBlID0gZ2V0RG9jdW1lbnRTaGFyaW5nVHlwZShzaGFyaW5nLCBkb2NJZCk7XG4gICAgcmV0dXJuIHNoYXJpbmcuYXR0cmlidXRlcy5tZW1iZXJzLm1hcChmdW5jdGlvbiAobSwgaWR4KSB7XG4gICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBtKSwge30sIHtcbiAgICAgICAgdHlwZTogbS5yZWFkX29ubHkgPyAnb25lLXdheScgOiB0eXBlLFxuICAgICAgICBzaGFyaW5nSWQ6IHNoYXJpbmcuaWQsXG4gICAgICAgIGluZGV4OiBpZHgsXG4gICAgICAgIGF2YXRhclBhdGg6IFwiL3NoYXJpbmdzL1wiLmNvbmNhdChzaGFyaW5nLmlkLCBcIi9yZWNpcGllbnRzL1wiKS5jb25jYXQoaWR4LCBcIi9hdmF0YXJcIilcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgbWVtYmVyKSB7XG4gICAgcmV0dXJuIGFjYy5jb25jYXQobWVtYmVyKTtcbiAgfSwgW10pLmZpbHRlcihmdW5jdGlvbiAocikge1xuICAgIHJldHVybiByLnN0YXR1cyAhPT0gJ3Jldm9rZWQnO1xuICB9KTtcblxuICBpZiAocmVjaXBpZW50c1swXSAmJiByZWNpcGllbnRzWzBdLnN0YXR1cyA9PT0gJ293bmVyJykge1xuICAgIHJldHVybiBbcmVjaXBpZW50c1swXV0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShyZWNpcGllbnRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuICAgICAgcmV0dXJuIHIuc3RhdHVzICE9PSAnb3duZXInO1xuICAgIH0pKSk7XG4gIH1cblxuICByZXR1cm4gcmVjaXBpZW50cztcbn07XG5leHBvcnQgdmFyIGdldFNoYXJpbmdMaW5rID0gZnVuY3Rpb24gZ2V0U2hhcmluZ0xpbmsoc3RhdGUsIGRvY0lkLCBkb2N1bWVudFR5cGUpIHtcbiAgLy8gVGhpcyBzaG91bGRuJ3QgaGF2ZSBoYXBwZW5lZCwgYnV0IHVuZm9ydHVuYXRlbHkgc29tZSBkdXBsaWNhdGUgc2hhcmluZyBsaW5rcyBoYXZlIGJlZW4gY3JlYXRlZCBpbiB0aGUgcGFzdFxuICB2YXIgcGVybXMgPSBnZXREb2N1bWVudFBlcm1pc3Npb25zKHN0YXRlLCBkb2NJZCk7XG4gIGlmIChwZXJtcy5sZW5ndGggPT09IDApIHJldHVybiBudWxsO1xuICB2YXIgcGVybSA9IHBlcm1zWzBdOyAvLyBXZSB1c2VkIHRvIHVzZSBgZW1haWxgIGFzIGBjb2Rlc2AgYXR0cmlidXRlIGZvciBhIHNoYXJpbmdCeUxpbmsuXG4gIC8vIEJ1dCB3aGVuIHdlIHVzZSBjb3p5LWNsaWVudCB0byBjcmVhdGUgYSBQZXJtaXNzaW9uLCBieSBkZWZhdWx0XG4gIC8vIHRoZSBjb2RlcyBhdHRyaWJ1dGUgaXMgc2V0IHRvIGBjb2RlYC4gTWVzUGFwaWVycyBhcHAgaXMgdXNpbmcgdGhpc1xuICAvLyBkZWZhdWx0IGJlaGF2aW9yLi4uIFNvIHRoZSBzaGFyaW5nIGJ5IGxpbmsgY3JlYXRlZCBieSBtZXMgcGFwaWVyc1xuICAvLyBkaWRuJ3QgYXBwZWFyIGNvcnJlY3RseSBpbiBjb3p5LXNoYXJpbmcuXG4gIC8vIFRoaXMgaXMgYSBiaXQgdWdseSwgd2Ugc2hvdWxkIGhhdmUgYSBiZXR0ZXIgd2F5IHRvIGtub3cgaWYgdGhpcyBpc1xuICAvLyBhIHNoYXJpbmcgYnkgbGluayBvciBub3QuXG5cbiAgdmFyIGNvZGUgPSBnZXQocGVybSwgJ2F0dHJpYnV0ZXMuc2hvcnRjb2Rlcy5lbWFpbCcpIHx8IGdldChwZXJtLCAnYXR0cmlidXRlcy5zaG9ydGNvZGVzLmNvZGUnKSB8fCBnZXQocGVybSwgJ2F0dHJpYnV0ZXMuY29kZXMuZW1haWwnKSB8fCBnZXQocGVybSwgJ2F0dHJpYnV0ZXMuY29kZXMuY29kZScpO1xuXG4gIGlmIChjb2RlKSB7XG4gICAgcmV0dXJuIGJ1aWxkU2hhcmluZ0xpbmsoc3RhdGUsIGRvY3VtZW50VHlwZSwgY29kZSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG5leHBvcnQgdmFyIGdldFNoYXJpbmdGb3JTZWxmID0gZnVuY3Rpb24gZ2V0U2hhcmluZ0ZvclNlbGYoc3RhdGUsIGRvY0lkKSB7XG4gIHJldHVybiBnZXREb2N1bWVudFNoYXJpbmcoc3RhdGUsIGRvY0lkKTtcbn07XG5leHBvcnQgdmFyIGdldFNoYXJpbmdUeXBlID0gZnVuY3Rpb24gZ2V0U2hhcmluZ1R5cGUoc3RhdGUsIGRvY0lkLCBpbnN0YW5jZVVyaSkge1xuICB2YXIgc2hhcmluZyA9IGdldFNoYXJpbmdGb3JTZWxmKHN0YXRlLCBkb2NJZCk7XG4gIGlmICghc2hhcmluZykgcmV0dXJuIGZhbHNlO1xuICB2YXIgdHlwZSA9IGdldERvY3VtZW50U2hhcmluZ1R5cGUoc2hhcmluZywgZG9jSWQpO1xuICBpZiAoc2hhcmluZy5hdHRyaWJ1dGVzLm93bmVyKSByZXR1cm4gdHlwZTtcbiAgdmFyIG1lID0gc2hhcmluZy5hdHRyaWJ1dGVzLm1lbWJlcnMuZmluZChtYXRjaGluZ0luc3RhbmNlTmFtZShpbnN0YW5jZVVyaSkpO1xuICByZXR1cm4gbWUgJiYgbWUucmVhZF9vbmx5ID8gJ29uZS13YXknIDogdHlwZTtcbn07XG5leHBvcnQgdmFyIGdldERvY3VtZW50U2hhcmluZyA9IGZ1bmN0aW9uIGdldERvY3VtZW50U2hhcmluZyhzdGF0ZSwgZG9jSWQpIHtcbiAgcmV0dXJuIGdldERvY3VtZW50U2hhcmluZ3Moc3RhdGUsIGRvY0lkKVswXSB8fCBudWxsO1xufTtcblxudmFyIGdldERvY3VtZW50U2hhcmluZ3MgPSBmdW5jdGlvbiBnZXREb2N1bWVudFNoYXJpbmdzKHN0YXRlLCBkb2NJZCkge1xuICByZXR1cm4gIXN0YXRlLmJ5RG9jSWRbZG9jSWRdID8gW10gOiBzdGF0ZS5ieURvY0lkW2RvY0lkXS5zaGFyaW5ncy5tYXAoZnVuY3Rpb24gKGlkKSB7XG4gICAgcmV0dXJuIGdldFNoYXJpbmdCeUlkKHN0YXRlLCBpZCk7XG4gIH0pO1xufTtcblxuZXhwb3J0IHZhciBnZXRTaGFyaW5nQnlJZCA9IGZ1bmN0aW9uIGdldFNoYXJpbmdCeUlkKHN0YXRlLCBpZCkge1xuICByZXR1cm4gc3RhdGUuc2hhcmluZ3MuZmluZChmdW5jdGlvbiAocykge1xuICAgIHJldHVybiBzLmlkID09PSBpZDtcbiAgfSk7XG59O1xuZXhwb3J0IHZhciBnZXREb2N1bWVudFBlcm1pc3Npb25zID0gZnVuY3Rpb24gZ2V0RG9jdW1lbnRQZXJtaXNzaW9ucyhzdGF0ZSwgZG9jSWQpIHtcbiAgcmV0dXJuICFzdGF0ZS5ieURvY0lkW2RvY0lkXSA/IFtdIDogc3RhdGUuYnlEb2NJZFtkb2NJZF0ucGVybWlzc2lvbnMubWFwKGZ1bmN0aW9uIChpZCkge1xuICAgIHJldHVybiBnZXRQZXJtaXNzaW9uQnlJZChzdGF0ZSwgaWQpO1xuICB9KTtcbn07XG5cbnZhciBnZXRQZXJtaXNzaW9uQnlJZCA9IGZ1bmN0aW9uIGdldFBlcm1pc3Npb25CeUlkKHN0YXRlLCBpZCkge1xuICByZXR1cm4gc3RhdGUucGVybWlzc2lvbnMuZmluZChmdW5jdGlvbiAocykge1xuICAgIHJldHVybiBzLmlkID09PSBpZDtcbiAgfSk7XG59O1xuXG52YXIgZ2V0QXBwcyA9IGZ1bmN0aW9uIGdldEFwcHMoc3RhdGUpIHtcbiAgcmV0dXJuIHN0YXRlLmFwcHM7XG59O1xuXG5leHBvcnQgdmFyIGhhc1NoYXJlZFBhcmVudCA9IGZ1bmN0aW9uIGhhc1NoYXJlZFBhcmVudChzdGF0ZSwgZG9jdW1lbnRQYXRoKSB7XG4gIGlmICghc3RhdGUuc2hhcmVkUGF0aHMpIHtcbiAgICByZXR1cm4gZmFsc2U7IC8vIGhhc1NoYXJlZFBhcmVudCBzaG91bGQgbm90IG9jY3VyXG4gIH1cblxuICByZXR1cm4gc3RhdGUuc2hhcmVkUGF0aHMuc29tZShmdW5jdGlvbiAocGF0aCkge1xuICAgIHJldHVybiBkb2N1bWVudFBhdGguaW5kZXhPZihcIlwiLmNvbmNhdChwYXRoLCBcIi9cIikpID09PSAwO1xuICB9KTtcbn07XG5leHBvcnQgdmFyIGhhc1NoYXJlZENoaWxkID0gZnVuY3Rpb24gaGFzU2hhcmVkQ2hpbGQoc3RhdGUsIGRvY3VtZW50UGF0aCkge1xuICBpZiAoIXN0YXRlLnNoYXJlZFBhdGhzKSB7XG4gICAgcmV0dXJuIGZhbHNlOyAvLyBoYXNTaGFyZWRDaGlsZCBzaG91bGQgbm90IG9jY3VyXG4gIH1cblxuICB2YXIgcmV0ID0gc3RhdGUuc2hhcmVkUGF0aHMuc29tZShmdW5jdGlvbiAocGF0aCkge1xuICAgIHJldHVybiBwYXRoLmluZGV4T2YoXCJcIi5jb25jYXQoZG9jdW1lbnRQYXRoLCBcIi9cIikpID09PSAwO1xuICB9KTtcbiAgcmV0dXJuIHJldDtcbn07XG4vKipcbiAqIFJldHVybnMgdGhlIHBhdGggb2YgdGhlIHNoYXJlZCBwYXJlbnQgZm9yIGEgZ2l2ZW4gZG9jdW1lbnRcbiAqIEBwYXJhbSB7b2JqZWN0fSBzdGF0ZSAtIFJlZHV4IHN0YXRlXG4gKiBAcGFyYW0ge3N0cmluZ30gZG9jdW1lbnRQYXRoIC0gUGF0aCBvZiB0aGUgZ2l2ZW4gZG9jdW1lbnRcbiAqIEByZXR1cm5zIHtzdHJpbmd8bnVsbH0gUGF0aCBvZiB0aGUgc2hhcmVkIHBhcmVudFxuICovXG5cbmV4cG9ydCB2YXIgZ2V0U2hhcmVkUGFyZW50UGF0aCA9IGZ1bmN0aW9uIGdldFNoYXJlZFBhcmVudFBhdGgoc3RhdGUsIGRvY3VtZW50UGF0aCkge1xuICBpZiAoaGFzU2hhcmVkUGFyZW50KHN0YXRlLCBkb2N1bWVudFBhdGgpKSB7XG4gICAgcmV0dXJuIHN0YXRlLnNoYXJlZFBhdGhzLmZpbmQoZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgIHJldHVybiBkb2N1bWVudFBhdGguc3RhcnRzV2l0aChwYXRoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufTsgLy8gaGVscGVyc1xuXG5leHBvcnQgdmFyIGdldFNoYXJlZERvY0lkcyA9IGZ1bmN0aW9uIGdldFNoYXJlZERvY0lkcyhkb2MpIHtcbiAgcmV0dXJuIGRvYy50eXBlID09PSAnaW8uY296eS5zaGFyaW5ncycgPyBnZXRTaGFyaW5nRG9jSWRzKGRvYykgOiBnZXRQZXJtaXNzaW9uRG9jSWRzKGRvYyk7XG59O1xuZXhwb3J0IHZhciBnZXRTaGFyaW5nRG9jSWRzID0gZnVuY3Rpb24gZ2V0U2hhcmluZ0RvY0lkcyhzaGFyaW5nKSB7XG4gIHZhciBkb2NzID0gc2hhcmluZy5hdHRyaWJ1dGVzLnJ1bGVzLm1hcChmdW5jdGlvbiAocikge1xuICAgIHJldHVybiByLnZhbHVlcztcbiAgfSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIHZhbCkge1xuICAgIHJldHVybiBhY2MuY29uY2F0KHZhbCk7XG4gIH0sIFtdKTtcblxuICBpZiAoc2hhcmluZy5hdHRyaWJ1dGVzLnNob3J0Y3V0X2lkKSB7XG4gICAgZG9jcy5wdXNoKHNoYXJpbmcuYXR0cmlidXRlcy5zaG9ydGN1dF9pZCk7XG4gIH1cblxuICByZXR1cm4gZG9jcztcbn07XG4vKipcbiAqIEdldCBpZHMgb2Ygc2hhcmVkIGRvY3VtZW50cywgYnV0IG9ubHkgaWYgc2hhcmluZyBpcyByZWFkeSBzbyBmaWxlcyBleGlzdFxuICogQHBhcmFtIHtvYmplY3R9IHNoYXJpbmdcbiAqIEBwYXJhbSB7c3RyaW5nfSBpbnN0YW5jZVVyaVxuICogQHJldHVybnMge3N0cmluZ1tdfSBMaXN0IG9mIGRvY3VtZW50IGlkcyBvZiBhIHNoYXJpbmdcbiAqL1xuXG5leHBvcnQgdmFyIGdldEV4dGVybmFsU2hhcmluZ0lkcyA9IGZ1bmN0aW9uIGdldEV4dGVybmFsU2hhcmluZ0lkcyhzaGFyaW5nLCBpbnN0YW5jZVVyaSkge1xuICB2YXIgbWVtYmVyID0gc2hhcmluZy5hdHRyaWJ1dGVzLm1lbWJlcnMuZmluZChmdW5jdGlvbiAobWVtYmVyKSB7XG4gICAgcmV0dXJuIG1lbWJlci5pbnN0YW5jZSA9PT0gaW5zdGFuY2VVcmk7XG4gIH0pO1xuICB2YXIgZG9jcyA9IFtdO1xuXG4gIGlmICgobWVtYmVyID09PSBudWxsIHx8IG1lbWJlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWVtYmVyLnN0YXR1cykgPT09ICdyZWFkeScpIHtcbiAgICBkb2NzID0gc2hhcmluZy5hdHRyaWJ1dGVzLnJ1bGVzLm1hcChmdW5jdGlvbiAocikge1xuICAgICAgcmV0dXJuIHIudmFsdWVzO1xuICAgIH0pLnJlZHVjZShmdW5jdGlvbiAoYWNjLCB2YWwpIHtcbiAgICAgIHJldHVybiBhY2MuY29uY2F0KHZhbCk7XG4gICAgfSwgW10pO1xuICB9XG5cbiAgaWYgKHNoYXJpbmcuYXR0cmlidXRlcy5zaG9ydGN1dF9pZCkge1xuICAgIGRvY3MucHVzaChzaGFyaW5nLmF0dHJpYnV0ZXMuc2hvcnRjdXRfaWQpO1xuICB9XG5cbiAgcmV0dXJuIGRvY3M7XG59OyAvLyBTb21lIHBlcm1pc3Npb25zIGNhbiBub3QgaGF2ZSB2YWx1ZXMgc2luY2UgdGhleSBjYW5cbi8vIGJlIG9uIGEgZ2xvYmFsIGRvY3R5cGUuIEluIHRoYXQgY2FzZSwgd2UgY2FuJ3Qgc29ydFxuLy8gdGhlbSBieSBpZFxuXG5leHBvcnQgdmFyIGdldFBlcm1pc3Npb25Eb2NJZHMgPSBmdW5jdGlvbiBnZXRQZXJtaXNzaW9uRG9jSWRzKHBlcm0pIHtcbiAgcmV0dXJuIE9iamVjdC5rZXlzKHBlcm0uYXR0cmlidXRlcy5wZXJtaXNzaW9ucykubWFwKGZ1bmN0aW9uIChrKSB7XG4gICAgcmV0dXJuIHBlcm0uYXR0cmlidXRlcy5wZXJtaXNzaW9uc1trXS52YWx1ZXMgPyBwZXJtLmF0dHJpYnV0ZXMucGVybWlzc2lvbnNba10udmFsdWVzIDogW107XG4gIH0pLnJlZHVjZShmdW5jdGlvbiAoYWNjLCB2YWwpIHtcbiAgICByZXR1cm4gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShhY2MpLCBfdG9Db25zdW1hYmxlQXJyYXkodmFsKSk7XG4gIH0sIFtdKTtcbn07XG5cbnZhciBhcmVBbGxSZWNpcGllbnRzUmV2b2tlZCA9IGZ1bmN0aW9uIGFyZUFsbFJlY2lwaWVudHNSZXZva2VkKHNoYXJpbmcpIHtcbiAgcmV0dXJuIHNoYXJpbmcuYXR0cmlidXRlcy5vd25lciAmJiBzaGFyaW5nLmF0dHJpYnV0ZXMubWVtYmVycy5maWx0ZXIoZnVuY3Rpb24gKG0pIHtcbiAgICByZXR1cm4gbS5zdGF0dXMgIT09ICdyZXZva2VkJztcbiAgfSkubGVuZ3RoID09PSAxO1xufTtcblxudmFyIGhhc0JlZW5TZWxmUmV2b2tlZCA9IGZ1bmN0aW9uIGhhc0JlZW5TZWxmUmV2b2tlZChzaGFyaW5nLCBpbnN0YW5jZVVyaSkge1xuICB2YXIgbWUgPSBzaGFyaW5nLmF0dHJpYnV0ZXMubWVtYmVycy5maW5kKG1hdGNoaW5nSW5zdGFuY2VOYW1lKGluc3RhbmNlVXJpKSk7XG4gIHJldHVybiAhc2hhcmluZy5hdHRyaWJ1dGVzLm93bmVyICYmIG1lICYmIG1lLnN0YXR1cyA9PT0gJ3Jldm9rZWQnO1xufTtcbi8qKlxuICogUmV0dXJucyB0aGUgc2hhcmluZyBydWxlIG9mIGEgZG9jdW1lbnRcbiAqIEBwYXJhbSB7b2JqZWN0fSBzaGFyaW5nIC0gVGhlIHNoYXJpbmdcbiAqIEBwYXJhbSB7c3RyaW5nfSBkb2NJZCAtIElkIG9mIHRoZSBzaGFyZWQgZG9jdW1lbnRcbiAqIEByZXR1cm5zIHtvYmplY3R9IHNoYXJpbmcgcnVsZVxuICovXG5cblxudmFyIGdldFNoYXJpbmdSdWxlID0gZnVuY3Rpb24gZ2V0U2hhcmluZ1J1bGUoc2hhcmluZywgZG9jSWQpIHtcbiAgcmV0dXJuIHNoYXJpbmcuYXR0cmlidXRlcy5ydWxlcy5maW5kKGZ1bmN0aW9uIChyKSB7XG4gICAgcmV0dXJuIHIudmFsdWVzLmluZGV4T2YoZG9jSWQpICE9PSAtMTtcbiAgfSk7XG59O1xuLyoqXG4gKiBSZXR1cm5zIHRoZSBzaGFyaW5nIHR5cGUgb2YgYSBkaXJlY3RvcnlcbiAqIEBwYXJhbSB7b2JqZWN0fSBydWxlIC0gU2hhcmluZyBydWxlIG9mIGEgZG9jdW1lbnRcbiAqIEByZXR1cm5zIHtzdHJpbmd9IHR3by13YXkgb3Igb25lLXdheVxuICovXG5cblxudmFyIGdldERpcmVjdG9yeVNoYXJpbmdUeXBlID0gZnVuY3Rpb24gZ2V0RGlyZWN0b3J5U2hhcmluZ1R5cGUocnVsZSkge1xuICAvLyBJZiBhIGRvY3VtZW50IGhhcyBubyBydWxlLCBpdCBpcyBhIHNob3J0Y3V0IHByZXZpZXcgb2YgYSBzaGFyaW5nLlxuICAvLyBTaW5jZSB0aGUgc2hhcmluZyBoYXNuJ3QgYmVlbiBhY2NlcHRlZCwgaXQgY2FuJ3QgYmUgc3luY2VkIHNvIHdlIHJldHVybiB0aGUgXCJvbmUtd2F5XCIgdHlwZS5cbiAgLy8gVE9ETyA6IHRoZSBzaGFyaW5nIHR5cGUgc2hvdWxkbid0IGJlIGJhc2VkIG9uIHJ1bGUgYnV0IG9uIHJlYWR5X29ubHkgcHJvcCBvZiB0aGUgbWVtYmVyXG4gIHJldHVybiBydWxlICYmIHJ1bGUudXBkYXRlID09PSAnc3luYycgJiYgcnVsZS5yZW1vdmUgPT09ICdzeW5jJyA/ICd0d28td2F5JyA6ICdvbmUtd2F5Jztcbn07XG4vKipcbiAqIFJldHVybnMgdGhlIHNoYXJpbmcgdHlwZSBvZiBhIGZpbGVcbiAqIEBwYXJhbSB7b2JqZWN0fSBydWxlIC0gU2hhcmluZyBydWxlIG9mIGEgZG9jdW1lbnRcbiAqIEByZXR1cm5zIHtzdHJpbmd9IHR3by13YXkgb3Igb25lLXdheVxuICovXG5cblxudmFyIGdldEZpbGVTaGFyaW5nVHlwZSA9IGZ1bmN0aW9uIGdldEZpbGVTaGFyaW5nVHlwZShydWxlKSB7XG4gIC8vIElmIGEgZG9jdW1lbnQgaGFzIG5vIHJ1bGUsIGl0IGlzIGEgc2hvcnRjdXQgcHJldmlldyBvZiBhIHNoYXJpbmcuXG4gIC8vIFNpbmNlIHRoZSBzaGFyaW5nIGhhc24ndCBiZWVuIGFjY2VwdGVkLCBpdCBjYW4ndCBiZSBzeW5jZWQgc28gd2UgcmV0dXJuIHRoZSBcIm9uZS13YXlcIiB0eXBlLlxuICAvLyBUT0RPIDogdGhlIHNoYXJpbmcgdHlwZSBzaG91bGRuJ3QgYmUgYmFzZWQgb24gcnVsZSBidXQgb24gcmVhZHlfb25seSBwcm9wIG9mIHRoZSBtZW1iZXJcbiAgcmV0dXJuIHJ1bGUgJiYgcnVsZS51cGRhdGUgPT09ICdzeW5jJyAmJiBydWxlLnJlbW92ZSA9PT0gJ3Jldm9rZScgPyAndHdvLXdheScgOiAnb25lLXdheSc7XG59O1xuLyoqXG4gKiBSZXR1cm5zIHRoZSBzaGFyaW5nIHR5cGUgb2YgYSBkb2N1bWVudFxuICogQHBhcmFtIHtvYmplY3R9IHNoYXJpbmcgLSBUaGUgc2hhcmluZ1xuICogQHBhcmFtIHtzdHJpbmd9IGRvY0lkIC0gSWQgb2YgdGhlIHNoYXJlZCBkb2N1bWVudFxuICogQHJldHVybnMge3N0cmluZ30gdHdvLXdheSBvciBvbmUtd2F5XG4gKi9cblxuXG5leHBvcnQgdmFyIGdldERvY3VtZW50U2hhcmluZ1R5cGUgPSBmdW5jdGlvbiBnZXREb2N1bWVudFNoYXJpbmdUeXBlKHNoYXJpbmcsIGRvY0lkKSB7XG4gIGlmICghc2hhcmluZykgcmV0dXJuIG51bGw7XG4gIHZhciBydWxlID0gZ2V0U2hhcmluZ1J1bGUoc2hhcmluZywgZG9jSWQpO1xuICB2YXIgZGlyZWN0b3J5U2hhcmluZ1R5cGUgPSBnZXREaXJlY3RvcnlTaGFyaW5nVHlwZShydWxlKTtcbiAgdmFyIGZpbGVTaGFyaW5nVHlwZSA9IGdldEZpbGVTaGFyaW5nVHlwZShydWxlKTtcbiAgcmV0dXJuIGRpcmVjdG9yeVNoYXJpbmdUeXBlID09PSAndHdvLXdheScgfHwgZmlsZVNoYXJpbmdUeXBlID09PSAndHdvLXdheScgPyAndHdvLXdheScgOiAnb25lLXdheSc7XG59O1xuZXhwb3J0IHZhciBpc1JlYWRPbmx5U2hhcmluZyA9IGZ1bmN0aW9uIGlzUmVhZE9ubHlTaGFyaW5nKHNoYXJpbmcsIGRvY0lkKSB7XG4gIHZhciBydWxlID0gZ2V0U2hhcmluZ1J1bGUoc2hhcmluZywgZG9jSWQpO1xuICB2YXIgZGlyZWN0b3J5U2hhcmluZ1R5cGUgPSBnZXREaXJlY3RvcnlTaGFyaW5nVHlwZShydWxlKTtcbiAgdmFyIGZpbGVTaGFyaW5nVHlwZSA9IGdldEZpbGVTaGFyaW5nVHlwZShydWxlKTtcbiAgcmV0dXJuIGRpcmVjdG9yeVNoYXJpbmdUeXBlID09PSAndHdvLXdheScgfHwgZmlsZVNoYXJpbmdUeXBlID09PSAndHdvLXdheScgPyBmYWxzZSA6IHRydWU7XG59O1xuXG52YXIgYnVpbGRTaGFyaW5nTGluayA9IGZ1bmN0aW9uIGJ1aWxkU2hhcmluZ0xpbmsoc3RhdGUsIGRvY3VtZW50VHlwZSwgc2hhcmVjb2RlKSB7XG4gIHZhciBhcHBVcmwgPSBnZXRBcHBVcmxGb3JEb2N0eXBlKHN0YXRlLCBkb2N1bWVudFR5cGUpO1xuXG4gIHN3aXRjaCAoZG9jdW1lbnRUeXBlKSB7XG4gICAgY2FzZSAnTm90ZXMnOlxuICAgICAgcmV0dXJuIFwiXCIuY29uY2F0KGFwcFVybCwgXCJwdWJsaWMvP3NoYXJlY29kZT1cIikuY29uY2F0KHNoYXJlY29kZSk7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIFwiXCIuY29uY2F0KGFwcFVybCwgXCJwdWJsaWM/c2hhcmVjb2RlPVwiKS5jb25jYXQoc2hhcmVjb2RlKTtcbiAgfVxufTtcblxudmFyIGdldEFwcFVybEZvckRvY3R5cGUgPSBmdW5jdGlvbiBnZXRBcHBVcmxGb3JEb2N0eXBlKHN0YXRlLCBkb2N1bWVudFR5cGUpIHtcbiAgdmFyIGFwcHMgPSBnZXRBcHBzKHN0YXRlKTtcblxuICBzd2l0Y2ggKGRvY3VtZW50VHlwZSkge1xuICAgIGNhc2UgJ05vdGVzJzpcbiAgICAgIHJldHVybiBnZXRBcHBVcmwoYXBwcywgJ25vdGVzJyk7XG5cbiAgICBjYXNlICdGaWxlcyc6XG4gICAgY2FzZSAnRG9jdW1lbnQnOlxuICAgICAgcmV0dXJuIGdldEFwcFVybChhcHBzLCAnZHJpdmUnKTtcblxuICAgIGNhc2UgJ0FsYnVtcyc6XG4gICAgICByZXR1cm4gZ2V0QXBwVXJsKGFwcHMsICdwaG90b3MnKTtcblxuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTaGFyaW5nIGxpbms6IGRvbid0IGtub3cgd2hpY2ggYXBwIHRvIHVzZSBmb3IgZG9jdHlwZSBcIi5jb25jYXQoZG9jdW1lbnRUeXBlKSk7XG4gIH1cbn07XG5cbnZhciBnZXRBcHBVcmwgPSBmdW5jdGlvbiBnZXRBcHBVcmwoYXBwcywgYXBwTmFtZSkge1xuICB2YXIgYXBwID0gYXBwcy5maW5kKGZ1bmN0aW9uIChhKSB7XG4gICAgcmV0dXJuIGEuYXR0cmlidXRlcy5zbHVnID09PSBhcHBOYW1lICYmIGEuYXR0cmlidXRlcy5zdGF0ZSA9PT0gJ3JlYWR5JztcbiAgfSk7XG5cbiAgaWYgKCFhcHApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJTaGFyaW5nIGxpbms6IGFwcCBcIi5jb25jYXQoYXBwTmFtZSwgXCIgbm90IGluc3RhbGxlZFwiKSk7XG4gIH1cblxuICByZXR1cm4gYXBwLmxpbmtzLnJlbGF0ZWQ7XG59O1xuLyoqXG4gKlxuICogQHBhcmFtIHtTaGFyaW5nQ29sbGVjdGlvbn0gc2hhcmluZ3NcbiAqIEByZXR1cm4ge0FycmF5fSBBcnJheSBvZiBkb2NJZHNcbiAqL1xuXG5cbmV4cG9ydCB2YXIgZ2V0U2hhcmVkRG9jSWRzQnlTaGFyaW5ncyA9IGZ1bmN0aW9uIGdldFNoYXJlZERvY0lkc0J5U2hhcmluZ3Moc2hhcmluZ3MpIHtcbiAgdmFyIGRvY3MgPSBbXTtcbiAgaWYgKCFzaGFyaW5ncy5kYXRhKSByZXR1cm4gW107XG4gIHNoYXJpbmdzLmRhdGEuZm9yRWFjaChmdW5jdGlvbiAocykge1xuICAgIGlmIChzLmF0dHJpYnV0ZXMgJiYgcy5hdHRyaWJ1dGVzLmFjdGl2ZSkge1xuICAgICAgZG9jcy5wdXNoLmFwcGx5KGRvY3MsIF90b0NvbnN1bWFibGVBcnJheShnZXRTaGFyaW5nRG9jSWRzKHMpKSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGRvY3M7XG59OyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/cozy-sharing/dist/state.js\n");

/***/ })

})